2021-03-16T08:47:33.607373400Z Traceback (most recent call last):
2021-03-16T08:47:33.607401700Z   File "/tmp/entrypoint.py", line 91, in <module>
2021-03-16T08:47:33.607405400Z     main()
2021-03-16T08:47:33.607407300Z   File "/tmp/entrypoint.py", line 87, in main
2021-03-16T08:47:33.607409300Z     run_model(options.script, *options.args)
2021-03-16T08:47:33.607411200Z   File "/tmp/entrypoint.py", line 42, in run_model
2021-03-16T08:47:33.607413100Z     return check_output(log_file)
2021-03-16T08:47:33.607414900Z   File "/tmp/entrypoint.py", line 57, in check_output
2021-03-16T08:47:33.607416800Z     raise RuntimeError(f"Problem found running stata script:\n\n{output}")
2021-03-16T08:47:33.607419400Z RuntimeError: Problem found running stata script:
2021-03-16T08:47:33.607421300Z 
2021-03-16T08:47:33.607423100Z 
2021-03-16T08:47:33.607424800Z   ___  ____  ____  ____  ____ (R)
2021-03-16T08:47:33.607426600Z  /__    /   ____/   /   ____/
2021-03-16T08:47:33.607428500Z ___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
2021-03-16T08:47:33.607430400Z   Statistics/Data Analysis            StataCorp
2021-03-16T08:47:33.607443700Z                                       4905 Lakeway Drive
2021-03-16T08:47:33.607449000Z      MP - Parallel Edition            College Station, Texas 77845 USA
2021-03-16T08:47:33.607451500Z                                       800-STATA-PC        http://www.stata.com
2021-03-16T08:47:33.607453500Z                                       979-696-4600        stata@stata.com
2021-03-16T08:47:33.607455400Z                                       979-696-4601 (fax)
2021-03-16T08:47:33.607457300Z 
2021-03-16T08:47:33.607459000Z 3-user 32-core Stata network license expires 29 Apr 2021:
2021-03-16T08:47:33.607460900Z        Serial number:  501609309502
2021-03-16T08:47:33.607462700Z          Licensed to:  EBM DataLab
2021-03-16T08:47:33.607464500Z                        University of Oxford
2021-03-16T08:47:33.607466400Z 
2021-03-16T08:47:33.607468100Z Notes:
2021-03-16T08:47:33.607469900Z       1.  Stata is running in batch mode.
2021-03-16T08:47:33.607471700Z Some Unicode string functions will not behave correctly because ICU data file
2021-03-16T08:47:33.607473600Z     icudt54l.dat cannot be found at directory: "/usr/local/stata/utilities"
2021-03-16T08:47:33.607475500Z       2.  Unicode is supported; see help unicode_advice.
2021-03-16T08:47:33.607477300Z       3.  More than 2 billion observations are allowed; see help obs_advice.
2021-03-16T08:47:33.607479200Z       4.  Maximum number of variables is set to 5000; see help set_maxvar.
2021-03-16T08:47:33.607481100Z 
2021-03-16T08:47:33.607482900Z . do analysis/STATA_code.do 
2021-03-16T08:47:33.607484700Z 
2021-03-16T08:47:33.607492700Z . /*===========================================================================
2021-03-16T08:47:33.607494900Z > ===
2021-03-16T08:47:33.607496700Z > DO FILE NAME:                   create_analysis_dataset
2021-03-16T08:47:33.607498600Z > PROJECT:                                Immunosuppressant meds research
2021-03-16T08:47:33.607500600Z > DATE:                                   2nd Feb 2021
2021-03-16T08:47:33.607502400Z > AUTHOR:                                 M Yates
2021-03-16T08:47:33.607513500Z >                                                 adapted from C Rentsch       
2021-03-16T08:47:33.607518400Z >                                                                    
2021-03-16T08:47:33.607520700Z > DESCRIPTION OF FILE:    data management for immunosuppressant meds project  
2021-03-16T08:47:33.607522800Z >                                                 reformat variables 
2021-03-16T08:47:33.607524700Z >                                                 categorise variables
2021-03-16T08:47:33.607526900Z >                                                 label variables 
2021-03-16T08:47:33.607528800Z > DATASETS USED:                  data in memory (from output/input.csv)
2021-03-16T08:47:33.607530800Z > DATASETS CREATED:               none
2021-03-16T08:47:33.607532600Z > OTHER OUTPUT:                   logfiles, printed to folder $Logdir
2021-03-16T08:47:33.607534500Z > USER-INSTALLED ADO:      
2021-03-16T08:47:33.607536300Z >   (place .ado file(s) in analysis folder)                                    
2021-03-16T08:47:33.607538300Z >            
2021-03-16T08:47:33.607540100Z > =============================================================================
2021-03-16T08:47:33.607542000Z > =*/
2021-03-16T08:47:33.607543800Z . 
2021-03-16T08:47:33.607545600Z . import delimited `c(pwd)'/output/input.csv, clear
2021-03-16T08:47:33.607547500Z (115 vars, 50,000 obs)
2021-03-16T08:47:33.607549400Z 
2021-03-16T08:47:33.607551200Z . 
2021-03-16T08:47:33.607552900Z . * set filepaths
2021-03-16T08:47:33.607554700Z . 
2021-03-16T08:47:33.607556500Z . global projectdir `c(pwd)'
2021-03-16T08:47:33.607558300Z 
2021-03-16T08:47:33.607560000Z . di "$projectdir"
2021-03-16T08:47:33.607562000Z /workspace
2021-03-16T08:47:33.607563800Z 
2021-03-16T08:47:33.607565500Z . 
2021-03-16T08:47:33.607567300Z . global logdir "$projectdir/logs"
2021-03-16T08:47:33.607569200Z 
2021-03-16T08:47:33.607571000Z . di "$logdir"
2021-03-16T08:47:33.607572900Z /workspace/logs
2021-03-16T08:47:33.607574700Z 
2021-03-16T08:47:33.607579800Z . 
2021-03-16T08:47:33.607581700Z . * Open a log file
2021-03-16T08:47:33.607583500Z . cap log close
2021-03-16T08:47:33.607585300Z 
2021-03-16T08:47:33.607587100Z . log using "$logdir/cr_create_analysis_dataset", replace
2021-03-16T08:47:33.607589100Z (note: file /workspace/logs/cr_create_analysis_dataset.smcl not found)
2021-03-16T08:47:33.607591100Z -------------------------------------------------------------------------------
2021-03-16T08:47:33.607593000Z       name:  <unnamed>
2021-03-16T08:47:33.607594900Z        log:  /workspace/logs/cr_create_analysis_dataset.smcl
2021-03-16T08:47:33.607596800Z   log type:  smcl
2021-03-16T08:47:33.607598600Z  opened on:  16 Mar 2021, 08:47:31
2021-03-16T08:47:33.607600400Z 
2021-03-16T08:47:33.607602100Z . 
2021-03-16T08:47:33.607603800Z . * Set Ado file path
2021-03-16T08:47:33.607605600Z . adopath + "$projectdir/analysis/extra_ados"
2021-03-16T08:47:33.607607600Z   [1]  (BASE)      "/usr/local/stata/ado/base/"
2021-03-16T08:47:33.607609400Z   [2]  (SITE)      "/usr/local/ado/"
2021-03-16T08:47:33.607611300Z   [3]              "."
2021-03-16T08:47:33.607613200Z   [4]  (PERSONAL)  "~/ado/personal/"
2021-03-16T08:47:33.607615100Z   [5]  (PLUS)      "~/ado/plus/"
2021-03-16T08:47:33.607616900Z   [6]  (OLDPLACE)  "~/ado/"
2021-03-16T08:47:33.607618700Z   [7]              "/workspace/analysis/extra_ados"
2021-03-16T08:47:33.607620600Z 
2021-03-16T08:47:33.607622400Z . 
2021-03-16T08:47:33.607624100Z . /* SET Index date ===========================================================
2021-03-16T08:47:33.607626800Z > */
2021-03-16T08:47:33.607628700Z . global indexdate                        = "01/03/2020"
2021-03-16T08:47:33.607630600Z 
2021-03-16T08:47:33.607632300Z . 
2021-03-16T08:47:33.607634000Z . /* RENAME VARIABLES==========================================================
2021-03-16T08:47:33.607635900Z > =*/
2021-03-16T08:47:33.607637700Z . 
2021-03-16T08:47:33.607639400Z . rename inflammatory_bowel_disease_uncla ibd_uncla
2021-03-16T08:47:33.607641200Z 
2021-03-16T08:47:33.607643000Z . 
2021-03-16T08:47:33.607644700Z . /* Drop variables not needed ================================================
2021-03-16T08:47:33.607646600Z > */
2021-03-16T08:47:33.607648700Z . *calculating ckd from creat 
2021-03-16T08:47:33.607650600Z . drop ckd ethnicity_date mepolizumab_3m_0m mepolizumab_6m_3m vedolizumab_3m_0m
2021-03-16T08:47:33.607652500Z >  vedolizumab_6m_3m
2021-03-16T08:47:33.607654400Z 
2021-03-16T08:47:33.607656100Z . 
2021-03-16T08:47:33.607660100Z . /* CONVERT STRINGS TO DATE===================================================
2021-03-16T08:47:33.607662000Z > =*/
2021-03-16T08:47:33.607663800Z . /* Comorb dates are given with month/year only, so adding day 15 to enable
2021-03-16T08:47:33.607665700Z >    them to be processed as dates */
2021-03-16T08:47:33.607667600Z . 
2021-03-16T08:47:33.607669300Z . foreach var of varlist   crohns_disease                                      
2021-03-16T08:47:33.607671200Z >    ///
2021-03-16T08:47:33.607673100Z >                                                  ulcerative_colitis          
2021-03-16T08:47:33.607675000Z >                            ///
2021-03-16T08:47:33.607676900Z >                                                  ibd_uncla                   
2021-03-16T08:47:33.607678900Z >            ///
2021-03-16T08:47:33.607680800Z >                                                  atopic_dermatitis           
2021-03-16T08:47:33.607682700Z >                            ///
2021-03-16T08:47:33.607684500Z >                                                  psoriasis                   
2021-03-16T08:47:33.607686400Z >                                    ///
2021-03-16T08:47:33.607688300Z >                                                  hidradenitis_suppurativa    
2021-03-16T08:47:33.607690200Z >                    ///
2021-03-16T08:47:33.607692000Z >                                                  psoriatic_arthritis         
2021-03-16T08:47:33.607693900Z >                    ///
2021-03-16T08:47:33.607695800Z >                                                  rheumatoid_arthritis        
2021-03-16T08:47:33.607697700Z >                    ///
2021-03-16T08:47:33.607699500Z >                                                  ankylosing_spondylitis      
2021-03-16T08:47:33.607701400Z >                    ///
2021-03-16T08:47:33.607703100Z >                                                  chronic_cardiac_disease     
2021-03-16T08:47:33.607705000Z >                    ///
2021-03-16T08:47:33.607706800Z >                                                  hba1c_new                   
2021-03-16T08:47:33.607708700Z >                                    ///
2021-03-16T08:47:33.607710600Z >                                                  hba1c_old                   
2021-03-16T08:47:33.607712500Z >                                    ///
2021-03-16T08:47:33.607714300Z >                                                  hba1c_mmol_per_mol_date     
2021-03-16T08:47:33.607716200Z >                    ///
2021-03-16T08:47:33.607718100Z >                                                  hba1c_percentage_date       
2021-03-16T08:47:33.607720000Z >                    ///
2021-03-16T08:47:33.607724800Z >                                                  diabetes                    
2021-03-16T08:47:33.607726800Z >                                    ///
2021-03-16T08:47:33.607728700Z >                                                  hypertension                
2021-03-16T08:47:33.607731000Z >                            ///
2021-03-16T08:47:33.607732900Z >                                                  chronic_respiratory_disease 
2021-03-16T08:47:33.607734800Z >            ///
2021-03-16T08:47:33.607736600Z >                                                  esrf                        
2021-03-16T08:47:33.607738500Z >                                    ///
2021-03-16T08:47:33.607740400Z >                                                  copd                        
2021-03-16T08:47:33.607764500Z >                                    ///
2021-03-16T08:47:33.607768100Z >                                                  chronic_liver_disease       
2021-03-16T08:47:33.607770100Z >                    ///
2021-03-16T08:47:33.607771900Z >                                                  stroke                      
2021-03-16T08:47:33.607773800Z >                                    ///
2021-03-16T08:47:33.607775600Z >                                                  lung_cancer                 
2021-03-16T08:47:33.607777500Z >                            ///
2021-03-16T08:47:33.607779400Z >                                                  haem_cancer                 
2021-03-16T08:47:33.607781300Z >                            ///
2021-03-16T08:47:33.607783100Z >                                                  other_cancer                
2021-03-16T08:47:33.607785000Z >                            ///
2021-03-16T08:47:33.607786800Z >                                                  creatinine_date             
2021-03-16T08:47:33.607788700Z >                    ///
2021-03-16T08:47:33.607790500Z >                                                  organ_transplant            
2021-03-16T08:47:33.607792400Z >                            ///
2021-03-16T08:47:33.607794200Z >                                                  bmi_date_measured           
2021-03-16T08:47:33.607796100Z >                    {
2021-03-16T08:47:33.607797900Z   2.                                                         
2021-03-16T08:47:33.607799700Z .                 capture confirm string variable `var'
2021-03-16T08:47:33.607801600Z   3.                 if _rc!=0 {
2021-03-16T08:47:33.607803400Z   4.                         assert `var'==.
2021-03-16T08:47:33.607805200Z   5.                         rename `var' `var'_date
2021-03-16T08:47:33.607807100Z   6.                 }
2021-03-16T08:47:33.607808900Z   7.         
2021-03-16T08:47:33.607813400Z .                 else {
2021-03-16T08:47:33.607815400Z   8.                                 replace `var' = `var' + "-15"
2021-03-16T08:47:33.607817300Z   9.                                 rename `var' `var'_dstr
2021-03-16T08:47:33.607819200Z  10.                                 replace `var'_dstr = " " if `var'_dstr == 
2021-03-16T08:47:33.607821200Z > "-15"
2021-03-16T08:47:33.607823000Z  11.                                 gen `var'_date = date(`var'_dstr, "YMD") 
2021-03-16T08:47:33.607825300Z  12.                                 order `var'_date, after(`var'_dstr)
2021-03-16T08:47:33.607827200Z  13.                                 drop `var'_dstr
2021-03-16T08:47:33.607829000Z  14.                 }
2021-03-16T08:47:33.607830800Z  15.         
2021-03-16T08:47:33.607832600Z .         format `var'_date %td
2021-03-16T08:47:33.607834400Z  16. }
2021-03-16T08:47:33.607836600Z variable crohns_disease was str7 now str10
2021-03-16T08:47:33.607838400Z (50,000 real changes made)
2021-03-16T08:47:33.607840200Z (40,000 real changes made)
2021-03-16T08:47:33.607842000Z (40,000 missing values generated)
2021-03-16T08:47:33.607843800Z variable ulcerative_colitis was str7 now str10
2021-03-16T08:47:33.607845600Z (50,000 real changes made)
2021-03-16T08:47:33.607847400Z (40,000 real changes made)
2021-03-16T08:47:33.607849400Z (40,000 missing values generated)
2021-03-16T08:47:33.607851100Z variable ibd_uncla was str7 now str10
2021-03-16T08:47:33.607852900Z (50,000 real changes made)
2021-03-16T08:47:33.607854700Z (40,000 real changes made)
2021-03-16T08:47:33.607856500Z (40,000 missing values generated)
2021-03-16T08:47:33.607858300Z variable atopic_dermatitis was str7 now str10
2021-03-16T08:47:33.607860100Z (50,000 real changes made)
2021-03-16T08:47:33.607861900Z (40,000 real changes made)
2021-03-16T08:47:33.607863700Z (40,000 missing values generated)
2021-03-16T08:47:33.607866100Z variable psoriasis was str7 now str10
2021-03-16T08:47:33.607867900Z (50,000 real changes made)
2021-03-16T08:47:33.607869700Z (40,000 real changes made)
2021-03-16T08:47:33.607871400Z (40,000 missing values generated)
2021-03-16T08:47:33.607873200Z variable hidradenitis_suppurativa was str7 now str10
2021-03-16T08:47:33.607875100Z (50,000 real changes made)
2021-03-16T08:47:33.607876900Z (40,000 real changes made)
2021-03-16T08:47:33.607878700Z (40,000 missing values generated)
2021-03-16T08:47:33.607880600Z variable psoriatic_arthritis was str7 now str10
2021-03-16T08:47:33.607882400Z (50,000 real changes made)
2021-03-16T08:47:33.607884100Z (40,000 real changes made)
2021-03-16T08:47:33.607887900Z (40,000 missing values generated)
2021-03-16T08:47:33.607889800Z variable rheumatoid_arthritis was str7 now str10
2021-03-16T08:47:33.607891700Z (50,000 real changes made)
2021-03-16T08:47:33.607893500Z (40,000 real changes made)
2021-03-16T08:47:33.607895200Z (40,000 missing values generated)
2021-03-16T08:47:33.607897000Z variable ankylosing_spondylitis was str7 now str10
2021-03-16T08:47:33.607898800Z (50,000 real changes made)
2021-03-16T08:47:33.607900600Z (40,000 real changes made)
2021-03-16T08:47:33.607902400Z (40,000 missing values generated)
2021-03-16T08:47:33.607904400Z variable chronic_cardiac_disease was str7 now str10
2021-03-16T08:47:33.607906200Z (50,000 real changes made)
2021-03-16T08:47:33.607908000Z (40,000 real changes made)
2021-03-16T08:47:33.607909800Z (40,000 missing values generated)
2021-03-16T08:47:33.607911600Z variable hba1c_new was str7 now str10
2021-03-16T08:47:33.607913800Z (50,000 real changes made)
2021-03-16T08:47:33.607915600Z (40,000 real changes made)
2021-03-16T08:47:33.607917300Z (40,000 missing values generated)
2021-03-16T08:47:33.607919100Z variable hba1c_old was str7 now str10
2021-03-16T08:47:33.607920900Z (50,000 real changes made)
2021-03-16T08:47:33.607922600Z (40,000 real changes made)
2021-03-16T08:47:33.607924400Z (40,000 missing values generated)
2021-03-16T08:47:33.607926200Z variable hba1c_mmol_per_mol_date was str7 now str10
2021-03-16T08:47:33.607928000Z (50,000 real changes made)
2021-03-16T08:47:33.607929800Z (2,500 real changes made)
2021-03-16T08:47:33.607931600Z (2,500 missing values generated)
2021-03-16T08:47:33.607933400Z variable hba1c_percentage_date was str7 now str10
2021-03-16T08:47:33.607935200Z (50,000 real changes made)
2021-03-16T08:47:33.607937100Z (2,500 real changes made)
2021-03-16T08:47:33.607938900Z (2,500 missing values generated)
2021-03-16T08:47:33.607940700Z variable diabetes was str7 now str10
2021-03-16T08:47:33.607942600Z (50,000 real changes made)
2021-03-16T08:47:33.607944300Z (40,000 real changes made)
2021-03-16T08:47:33.607946100Z (40,000 missing values generated)
2021-03-16T08:47:33.607948300Z variable hypertension was str7 now str10
2021-03-16T08:47:33.607950400Z (50,000 real changes made)
2021-03-16T08:47:33.607952200Z (40,000 real changes made)
2021-03-16T08:47:33.607953900Z (40,000 missing values generated)
2021-03-16T08:47:33.607955700Z variable chronic_respiratory_disease was str7 now str10
2021-03-16T08:47:33.607957500Z (50,000 real changes made)
2021-03-16T08:47:33.607959500Z (40,000 real changes made)
2021-03-16T08:47:33.607963000Z (40,000 missing values generated)
2021-03-16T08:47:33.607965000Z variable esrf was str7 now str10
2021-03-16T08:47:33.607966800Z (50,000 real changes made)
2021-03-16T08:47:33.607968600Z (45,000 real changes made)
2021-03-16T08:47:33.607970300Z (45,000 missing values generated)
2021-03-16T08:47:33.607972100Z variable copd was str7 now str10
2021-03-16T08:47:33.607973900Z (50,000 real changes made)
2021-03-16T08:47:33.607975700Z (40,000 real changes made)
2021-03-16T08:47:33.607977600Z (40,000 missing values generated)
2021-03-16T08:47:33.607979500Z variable chronic_liver_disease was str7 now str10
2021-03-16T08:47:33.607981400Z (50,000 real changes made)
2021-03-16T08:47:33.607983100Z (40,000 real changes made)
2021-03-16T08:47:33.607984900Z (40,000 missing values generated)
2021-03-16T08:47:33.607986800Z variable stroke was str7 now str10
2021-03-16T08:47:33.607988900Z (50,000 real changes made)
2021-03-16T08:47:33.607990600Z (40,000 real changes made)
2021-03-16T08:47:33.607992400Z (40,000 missing values generated)
2021-03-16T08:47:33.607994200Z variable lung_cancer was str7 now str10
2021-03-16T08:47:33.607996000Z (50,000 real changes made)
2021-03-16T08:47:33.607997800Z (40,000 real changes made)
2021-03-16T08:47:33.607999700Z (40,000 missing values generated)
2021-03-16T08:47:33.608001400Z variable haem_cancer was str7 now str10
2021-03-16T08:47:33.608003300Z (50,000 real changes made)
2021-03-16T08:47:33.608005100Z (40,000 real changes made)
2021-03-16T08:47:33.608006800Z (40,000 missing values generated)
2021-03-16T08:47:33.608008600Z variable other_cancer was str7 now str10
2021-03-16T08:47:33.608010400Z (50,000 real changes made)
2021-03-16T08:47:33.608023200Z (40,000 real changes made)
2021-03-16T08:47:33.608027400Z (40,000 missing values generated)
2021-03-16T08:47:33.608029600Z variable creatinine_date was str7 now str10
2021-03-16T08:47:33.608031500Z (50,000 real changes made)
2021-03-16T08:47:33.608033400Z (2,500 real changes made)
2021-03-16T08:47:33.608035200Z (2,500 missing values generated)
2021-03-16T08:47:33.608037000Z variable organ_transplant was str7 now str10
2021-03-16T08:47:33.608038900Z (50,000 real changes made)
2021-03-16T08:47:33.608040700Z (40,000 real changes made)
2021-03-16T08:47:33.608042500Z (40,000 missing values generated)
2021-03-16T08:47:33.608044300Z variable bmi_date_measured was str7 now str10
2021-03-16T08:47:33.608046100Z (50,000 real changes made)
2021-03-16T08:47:33.608047900Z (20,000 real changes made)
2021-03-16T08:47:33.608049700Z (20,000 missing values generated)
2021-03-16T08:47:33.608054700Z 
2021-03-16T08:47:33.608056600Z . 
2021-03-16T08:47:33.608058400Z . /*conversion for dates with day already included*/
2021-03-16T08:47:33.608060200Z . 
2021-03-16T08:47:33.608062000Z . foreach var of varlist   icu_date_admitted                                   
2021-03-16T08:47:33.608063900Z >    ///
2021-03-16T08:47:33.608066000Z >                                                  died_date_ons               
2021-03-16T08:47:33.608068200Z >                            ///
2021-03-16T08:47:33.608070000Z >                                                  first_pos_test_sgss         
2021-03-16T08:47:33.608072000Z >                    ///
2021-03-16T08:47:33.608073800Z >                                                  {
2021-03-16T08:47:33.608075700Z   2.                                                  
2021-03-16T08:47:33.608077700Z .                 capture confirm string variable `var'
2021-03-16T08:47:33.608079900Z   3.                 if _rc!=0 {
2021-03-16T08:47:33.608081800Z   4.                         assert `var'==.
2021-03-16T08:47:33.608083700Z   5.                         rename `var' `var'_date
2021-03-16T08:47:33.608085600Z   6.                 }
2021-03-16T08:47:33.608087500Z   7.         
2021-03-16T08:47:33.608089300Z .                 else {
2021-03-16T08:47:33.608091300Z   8.                                 rename `var' `var'_dstr
2021-03-16T08:47:33.608093200Z   9.                                 gen `var'_date = date(`var'_dstr, "YMD") 
2021-03-16T08:47:33.608095100Z  10.                                 order `var'_date, after(`var'_dstr)
2021-03-16T08:47:33.608097100Z  11.                                 drop `var'_dstr
2021-03-16T08:47:33.608098900Z  12.                                 gen `var'_date15 = `var'_date+15
2021-03-16T08:47:33.608101600Z  13.                                 order `var'_date15, after(`var'_date)
2021-03-16T08:47:33.608103500Z  14.                                 drop `var'_date
2021-03-16T08:47:33.608105400Z  15.                                 rename `var'_date15 `var'_date
2021-03-16T08:47:33.608107500Z  16.                 }
2021-03-16T08:47:33.608109300Z  17.         
2021-03-16T08:47:33.608111100Z .         format `var'_date %td
2021-03-16T08:47:33.608112900Z  18. }
2021-03-16T08:47:33.608114700Z (45,000 missing values generated)
2021-03-16T08:47:33.608116400Z (45,000 missing values generated)
2021-03-16T08:47:33.608118200Z (45,000 missing values generated)
2021-03-16T08:47:33.608120000Z (45,000 missing values generated)
2021-03-16T08:47:33.608121800Z (45,000 missing values generated)
2021-03-16T08:47:33.608123500Z (45,000 missing values generated)
2021-03-16T08:47:33.608125300Z 
2021-03-16T08:47:33.608129300Z .                                                  
2021-03-16T08:47:33.608131400Z . 
2021-03-16T08:47:33.608133300Z . /* RENAME VARAIBLES==========================================================
2021-03-16T08:47:33.608135200Z > =*/
2021-03-16T08:47:33.608137000Z . *  An extra 'date' added to the end of some variable names, remove 
2021-03-16T08:47:33.608139000Z . rename icu_date_admitted_date                   icu_admitted_date            
2021-03-16T08:47:33.608141000Z >            
2021-03-16T08:47:33.608143600Z 
2021-03-16T08:47:33.608145600Z . rename bmi_date_measured_date                   bmi_measured_date
2021-03-16T08:47:33.608148000Z 
2021-03-16T08:47:33.608149800Z . rename died_date_ons_date                       died_ons_date 
2021-03-16T08:47:33.608151700Z 
2021-03-16T08:47:33.608153400Z . rename creatinine_date_date                             creatinine_measured_d
2021-03-16T08:47:33.608155300Z > ate
2021-03-16T08:47:33.608157100Z 
2021-03-16T08:47:33.608158900Z . rename hba1c_mmol_per_mol_date_date             hba1c_mmol_per_mol_date 
2021-03-16T08:47:33.608160800Z 
2021-03-16T08:47:33.608162800Z . rename hba1c_percentage_date_date               hba1c_percentage_date
2021-03-16T08:47:33.608164900Z 
2021-03-16T08:47:33.608166800Z . 
2021-03-16T08:47:33.608168900Z . 
2021-03-16T08:47:33.608170700Z . * Some names too long for loops below, shorten
2021-03-16T08:47:33.608172600Z . 
2021-03-16T08:47:33.608174300Z . /* CREATE BINARY VARIABLES===================================================
2021-03-16T08:47:33.608176300Z > =*/
2021-03-16T08:47:33.608178000Z . 
2021-03-16T08:47:33.608179700Z . 
2021-03-16T08:47:33.608181600Z . *  Make indicator variables for all conditions where relevant 
2021-03-16T08:47:33.608183600Z . 
2021-03-16T08:47:33.608185400Z . 
2021-03-16T08:47:33.608187100Z . foreach var of varlist   crohns_disease_date                                /
2021-03-16T08:47:33.608189100Z > //
2021-03-16T08:47:33.608191700Z >                                                  ulcerative_colitis_date     
2021-03-16T08:47:33.608193600Z >                            ///
2021-03-16T08:47:33.608195600Z >                                                  ibd_uncla_date              
2021-03-16T08:47:33.608197600Z >            ///
2021-03-16T08:47:33.608199700Z >                                                  psoriasis_date              
2021-03-16T08:47:33.608201700Z >                                    ///
2021-03-16T08:47:33.608203500Z >                                                  atopic_dermatitis_date      
2021-03-16T08:47:33.608207600Z >                            ///
2021-03-16T08:47:33.608209700Z >                                                  hidradenitis_suppurativa_dat
2021-03-16T08:47:33.608211800Z > e                  ///
2021-03-16T08:47:33.608213600Z >                                                  psoriatic_arthritis_date    
2021-03-16T08:47:33.608215600Z >                            ///
2021-03-16T08:47:33.608217500Z >                                                  rheumatoid_arthritis_date   
2021-03-16T08:47:33.608219300Z >                ///
2021-03-16T08:47:33.608221200Z >                                                  ankylosing_spondylitis_date 
2021-03-16T08:47:33.608223200Z >                    ///
2021-03-16T08:47:33.608225100Z >                                                  chronic_cardiac_disease_date
2021-03-16T08:47:33.608227000Z >                    ///
2021-03-16T08:47:33.608228900Z >                                                  hypertension_date           
2021-03-16T08:47:33.608230800Z >                                    ///
2021-03-16T08:47:33.608232600Z >                                                  chronic_respiratory_disease_
2021-03-16T08:47:33.608234600Z > date               ///
2021-03-16T08:47:33.608236600Z >                                                  copd_date                   
2021-03-16T08:47:33.608238700Z >                                            ///
2021-03-16T08:47:33.608240600Z >                                                  chronic_liver_disease_date  
2021-03-16T08:47:33.608242500Z >                            ///
2021-03-16T08:47:33.608244400Z >                                                  stroke_date                 
2021-03-16T08:47:33.608246500Z >                                    ///
2021-03-16T08:47:33.608248300Z >                                                  lung_cancer_date            
2021-03-16T08:47:33.608250200Z >                                    ///
2021-03-16T08:47:33.608252100Z >                                                  haem_cancer_date            
2021-03-16T08:47:33.608254000Z >                                    ///
2021-03-16T08:47:33.608255800Z >                                                  other_cancer_date           
2021-03-16T08:47:33.608257700Z >                                    ///
2021-03-16T08:47:33.608259600Z >                                                  diabetes_date               
2021-03-16T08:47:33.608261500Z >                                    ///
2021-03-16T08:47:33.608263600Z >                                                  esrf_date                   
2021-03-16T08:47:33.608265500Z >                                            ///
2021-03-16T08:47:33.608267400Z >                                                  creatinine_measured_date    
2021-03-16T08:47:33.608270600Z >                ///
2021-03-16T08:47:33.608272500Z >                                                  organ_transplant_date       
2021-03-16T08:47:33.608274400Z >                            ///
2021-03-16T08:47:33.608276200Z >                                                  bmi_measured_date           
2021-03-16T08:47:33.608278400Z >                                ///
2021-03-16T08:47:33.608280400Z >                                                  icu_admitted_date           
2021-03-16T08:47:33.608282300Z >                                ///
2021-03-16T08:47:33.608284100Z >                                                  died_ons_date               
2021-03-16T08:47:33.608286000Z >                                    ///
2021-03-16T08:47:33.608287900Z >                                                  first_pos_test_sgss_date    
2021-03-16T08:47:33.608290000Z >    {
2021-03-16T08:47:33.608291700Z   2.         /* date ranges are applied in python, so presence of date indicate
2021-03-16T08:47:33.608293800Z > s presence of 
2021-03-16T08:47:33.608295600Z >           disease in the correct time frame */ 
2021-03-16T08:47:33.608297600Z .         local newvar =  substr("`var'", 1, length("`var'") - 5)
2021-03-16T08:47:33.608299800Z   3.         gen `newvar' = (`var'!=. )
2021-03-16T08:47:33.608301700Z   4.         order `newvar', after(`var')
2021-03-16T08:47:33.608303700Z   5. }
2021-03-16T08:47:33.608305500Z 
2021-03-16T08:47:33.608307200Z . 
2021-03-16T08:47:33.608308900Z . /* CREATE VARIABLES==========================================================
2021-03-16T08:47:33.608310900Z > =*/
2021-03-16T08:47:33.608312700Z . 
2021-03-16T08:47:33.608314600Z . /* DEMOGRAPHICS */ 
2021-03-16T08:47:33.608316400Z . 
2021-03-16T08:47:33.608318200Z . * Sex
2021-03-16T08:47:33.608320100Z . gen male = 1 if sex == "M"
2021-03-16T08:47:33.608322000Z (25,431 missing values generated)
2021-03-16T08:47:33.608323900Z 
2021-03-16T08:47:33.608325700Z . replace male = 0 if sex == "F"
2021-03-16T08:47:33.608327600Z (25,431 real changes made)
2021-03-16T08:47:33.608329400Z 
2021-03-16T08:47:33.608331200Z . 
2021-03-16T08:47:33.608333000Z . * Ethnicity
2021-03-16T08:47:33.608334900Z . replace ethnicity = .u if ethnicity == .
2021-03-16T08:47:33.608336700Z (12,500 real changes made, 12,500 to missing)
2021-03-16T08:47:33.608338500Z 
2021-03-16T08:47:33.608340200Z . 
2021-03-16T08:47:33.608342000Z . *rearrange in order of prevalence
2021-03-16T08:47:33.608345800Z . recode ethnicity 2=6 /* mixed to 6 */
2021-03-16T08:47:33.608347800Z (ethnicity: 0 changes made)
2021-03-16T08:47:33.608349700Z 
2021-03-16T08:47:33.608351600Z . recode ethnicity 3=2 /* south asian to 2 */
2021-03-16T08:47:33.608353600Z (ethnicity: 3704 changes made)
2021-03-16T08:47:33.608355500Z 
2021-03-16T08:47:33.608357300Z . recode ethnicity 4=3 /* black to 3 */
2021-03-16T08:47:33.608359100Z (ethnicity: 0 changes made)
2021-03-16T08:47:33.608361100Z 
2021-03-16T08:47:33.608362900Z . recode ethnicity 6=4 /* mixed to 4 */
2021-03-16T08:47:33.608364900Z (ethnicity: 0 changes made)
2021-03-16T08:47:33.608366800Z 
2021-03-16T08:47:33.608368600Z . 
2021-03-16T08:47:33.608370400Z . label define ethnicity  1 "White"                                       ///
2021-03-16T08:47:33.608372500Z >                                                 2 "South Asian"              
2021-03-16T08:47:33.608374700Z >            ///
2021-03-16T08:47:33.608376600Z >                                                 3 "Black"                    
2021-03-16T08:47:33.608378600Z >                    ///
2021-03-16T08:47:33.608381100Z >                                                 4 "Mixed"                    
2021-03-16T08:47:33.608383200Z >                    ///
2021-03-16T08:47:33.608385100Z >                                                 5 "Other"                    
2021-03-16T08:47:33.608387200Z >                    ///
2021-03-16T08:47:33.608389600Z >                                                 .u "Unknown"
2021-03-16T08:47:33.608391700Z 
2021-03-16T08:47:33.608393700Z . label values ethnicity ethnicity
2021-03-16T08:47:33.608395700Z 
2021-03-16T08:47:33.608397400Z . 
2021-03-16T08:47:33.608399100Z . gen ethnicity2 = ethnicity
2021-03-16T08:47:33.608401000Z (12,500 missing values generated)
2021-03-16T08:47:33.608402900Z 
2021-03-16T08:47:33.608404600Z . replace ethnicity2 = . if ethnicity == .u
2021-03-16T08:47:33.608406400Z (12,500 real changes made, 12,500 to missing)
2021-03-16T08:47:33.608408200Z 
2021-03-16T08:47:33.608410000Z . 
2021-03-16T08:47:33.608411800Z . * STP 
2021-03-16T08:47:33.608413600Z . rename stp stp_old
2021-03-16T08:47:33.608415300Z 
2021-03-16T08:47:33.608417200Z . bysort stp_old: gen stp = 1 if _n==1
2021-03-16T08:47:33.608419000Z (49,998 missing values generated)
2021-03-16T08:47:33.608420800Z 
2021-03-16T08:47:33.608422500Z . replace stp = sum(stp)
2021-03-16T08:47:33.608424300Z (49,999 real changes made)
2021-03-16T08:47:33.608430800Z 
2021-03-16T08:47:33.608432600Z . drop stp_old
2021-03-16T08:47:33.608434400Z 
2021-03-16T08:47:33.608436100Z . 
2021-03-16T08:47:33.608437800Z . /*  IMD  */
2021-03-16T08:47:33.608439600Z . * Group into 5 groups
2021-03-16T08:47:33.608441500Z . rename imd imd_o
2021-03-16T08:47:33.608443200Z 
2021-03-16T08:47:33.608444900Z . egen imd = cut(imd_o), group(5) icodes
2021-03-16T08:47:33.608446900Z 
2021-03-16T08:47:33.608448700Z . 
2021-03-16T08:47:33.608450400Z . * add one to create groups 1 - 5 
2021-03-16T08:47:33.608452200Z . replace imd = imd + 1
2021-03-16T08:47:33.608453900Z (50,000 real changes made)
2021-03-16T08:47:33.608455700Z 
2021-03-16T08:47:33.608457400Z . 
2021-03-16T08:47:33.608459100Z . * - 1 is missing, should be excluded from population 
2021-03-16T08:47:33.608461000Z . replace imd = .u if imd_o == -1
2021-03-16T08:47:33.608462700Z (0 real changes made)
2021-03-16T08:47:33.608464600Z 
2021-03-16T08:47:33.608467000Z . drop imd_o
2021-03-16T08:47:33.608468800Z 
2021-03-16T08:47:33.608470500Z . 
2021-03-16T08:47:33.608472400Z . * Reverse the order (so high is more deprived)
2021-03-16T08:47:33.608474400Z . recode imd 5 = 1 4 = 2 3 = 3 2 = 4 1 = 5 .u = .u
2021-03-16T08:47:33.608476700Z (imd: 50000 changes made)
2021-03-16T08:47:33.608478600Z 
2021-03-16T08:47:33.608480300Z . 
2021-03-16T08:47:33.608482200Z . label define imd 1 "1 least deprived" 2 "2" 3 "3" 4 "4" 5 "5 most deprived" .
2021-03-16T08:47:33.608484300Z > u "Unknown"
2021-03-16T08:47:33.608486200Z 
2021-03-16T08:47:33.608487900Z . label values imd imd 
2021-03-16T08:47:33.608489800Z 
2021-03-16T08:47:33.608491600Z . 
2021-03-16T08:47:33.608493300Z . /*  Age variables  */ 
2021-03-16T08:47:33.608495100Z . ********works if ages 18 and over
2021-03-16T08:47:33.608497400Z . * Create categorised age
2021-03-16T08:47:33.608499200Z . drop if age<18 & age !=.
2021-03-16T08:47:33.608501000Z (10,572 observations deleted)
2021-03-16T08:47:33.608502800Z 
2021-03-16T08:47:33.608504600Z . drop if age>109 & age !=.
2021-03-16T08:47:33.608506500Z (0 observations deleted)
2021-03-16T08:47:33.608508300Z 
2021-03-16T08:47:33.608510000Z . 
2021-03-16T08:47:33.608511800Z . recode age 18/39.9999 = 1 /// 
2021-03-16T08:47:33.608513600Z >            40/49.9999 = 2 ///
2021-03-16T08:47:33.608515400Z >                    50/59.9999 = 3 ///
2021-03-16T08:47:33.608519600Z >                60/69.9999 = 4 ///
2021-03-16T08:47:33.608521600Z >                    70/79.9999 = 5 ///
2021-03-16T08:47:33.608523500Z >                    80/max = 6, gen(agegroup) 
2021-03-16T08:47:33.608525400Z (39428 differences between age and agegroup)
2021-03-16T08:47:33.608527300Z 
2021-03-16T08:47:33.608529100Z . 
2021-03-16T08:47:33.608531000Z . label define agegroup   1 "18-<40" ///
2021-03-16T08:47:33.608533000Z >                                                 2 "40-<50" ///
2021-03-16T08:47:33.608535400Z >                                                 3 "50-<60" ///
2021-03-16T08:47:33.608537400Z >                                                 4 "60-<70" ///
2021-03-16T08:47:33.608539400Z >                                                 5 "70-<80" ///
2021-03-16T08:47:33.608541300Z >                                                 6 "80+"
2021-03-16T08:47:33.608543200Z 
2021-03-16T08:47:33.608544900Z .                                                 
2021-03-16T08:47:33.608547200Z . label values agegroup agegroup
2021-03-16T08:47:33.608549100Z 
2021-03-16T08:47:33.608550900Z . 
2021-03-16T08:47:33.608552700Z . * Create binary age
2021-03-16T08:47:33.608554500Z . recode age min/69.999 = 0 ///
2021-03-16T08:47:33.608556300Z >            70/max = 1, gen(age70)
2021-03-16T08:47:33.608558100Z (39428 differences between age and age70)
2021-03-16T08:47:33.608560200Z 
2021-03-16T08:47:33.608562200Z . 
2021-03-16T08:47:33.608564200Z . * Check there are no missing ages
2021-03-16T08:47:33.608566000Z . assert age < .
2021-03-16T08:47:33.608567900Z 
2021-03-16T08:47:33.608569600Z . assert agegroup < .
2021-03-16T08:47:33.608571600Z 
2021-03-16T08:47:33.608573400Z . assert age70 < .
2021-03-16T08:47:33.608575200Z 
2021-03-16T08:47:33.608576900Z . 
2021-03-16T08:47:33.608578700Z . * Create restricted cubic splines for age
2021-03-16T08:47:33.608581200Z . mkspline age = age, cubic nknots(4)
2021-03-16T08:47:33.608583000Z 
2021-03-16T08:47:33.608584700Z . 
2021-03-16T08:47:33.608586400Z . /*  Body Mass Index  */
2021-03-16T08:47:33.608588300Z . * NB: watch for missingness
2021-03-16T08:47:33.608590000Z . 
2021-03-16T08:47:33.608591700Z . * Recode strange values 
2021-03-16T08:47:33.608593500Z . replace bmi = . if bmi == 0 
2021-03-16T08:47:33.608595500Z (15,758 real changes made, 15,758 to missing)
2021-03-16T08:47:33.608599700Z 
2021-03-16T08:47:33.608601600Z . replace bmi = . if !inrange(bmi, 10, 60)
2021-03-16T08:47:33.608603500Z (269 real changes made, 269 to missing)
2021-03-16T08:47:33.608605400Z 
2021-03-16T08:47:33.608607300Z . 
2021-03-16T08:47:33.608609100Z . * Restrict to within 10 years of index and aged > 16 
2021-03-16T08:47:33.608611100Z . gen bmi_time = (date("$indexdate", "DMY") - bmi_measured_date)/365.25
2021-03-16T08:47:33.608613200Z (15,758 missing values generated)
2021-03-16T08:47:33.608615000Z 
2021-03-16T08:47:33.608617300Z . gen bmi_age = age - bmi_time
2021-03-16T08:47:33.608619400Z (15,758 missing values generated)
2021-03-16T08:47:33.608621200Z 
2021-03-16T08:47:33.608622900Z . 
2021-03-16T08:47:33.608624600Z . replace bmi = . if bmi_age < 16 
2021-03-16T08:47:33.608626500Z (16,937 real changes made, 16,937 to missing)
2021-03-16T08:47:33.608628300Z 
2021-03-16T08:47:33.608630000Z . replace bmi = . if bmi_time > 10 & bmi_time != . 
2021-03-16T08:47:33.608632100Z (4,492 real changes made, 4,492 to missing)
2021-03-16T08:47:33.608633900Z 
2021-03-16T08:47:33.608635800Z . 
2021-03-16T08:47:33.608637600Z . * Set to missing if no date, and vice versa 
2021-03-16T08:47:33.608639500Z . replace bmi = . if bmi_measured_date == . 
2021-03-16T08:47:33.608641300Z (0 real changes made)
2021-03-16T08:47:33.608643100Z 
2021-03-16T08:47:33.608644800Z . replace bmi_measured_date = . if bmi == . 
2021-03-16T08:47:33.608646700Z (21,698 real changes made, 21,698 to missing)
2021-03-16T08:47:33.608648700Z 
2021-03-16T08:47:33.608650400Z . replace bmi_measured_date = . if bmi == . 
2021-03-16T08:47:33.608652400Z (0 real changes made)
2021-03-16T08:47:33.608654500Z 
2021-03-16T08:47:33.608656400Z . 
2021-03-16T08:47:33.608658200Z . gen     bmicat = .
2021-03-16T08:47:33.608660000Z (39,428 missing values generated)
2021-03-16T08:47:33.608662000Z 
2021-03-16T08:47:33.608663800Z . recode  bmicat . = 1 if bmi < 18.5
2021-03-16T08:47:33.608665700Z (bmicat: 91 changes made)
2021-03-16T08:47:33.608667500Z 
2021-03-16T08:47:33.608669300Z . recode  bmicat . = 2 if bmi < 25
2021-03-16T08:47:33.608671100Z (bmicat: 200 changes made)
2021-03-16T08:47:33.608672900Z 
2021-03-16T08:47:33.608674700Z . recode  bmicat . = 3 if bmi < 30
2021-03-16T08:47:33.608676500Z (bmicat: 314 changes made)
2021-03-16T08:47:33.608678400Z 
2021-03-16T08:47:33.608680200Z . recode  bmicat . = 4 if bmi < 35
2021-03-16T08:47:33.608682100Z (bmicat: 372 changes made)
2021-03-16T08:47:33.608686100Z 
2021-03-16T08:47:33.608688300Z . recode  bmicat . = 5 if bmi < 40
2021-03-16T08:47:33.608690200Z (bmicat: 362 changes made)
2021-03-16T08:47:33.608692000Z 
2021-03-16T08:47:33.608694200Z . recode  bmicat . = 6 if bmi < .
2021-03-16T08:47:33.608696100Z (bmicat: 633 changes made)
2021-03-16T08:47:33.608697900Z 
2021-03-16T08:47:33.608699600Z . replace bmicat = .u if bmi >= .
2021-03-16T08:47:33.608701700Z (37,456 real changes made, 37,456 to missing)
2021-03-16T08:47:33.608703600Z 
2021-03-16T08:47:33.608705400Z . 
2021-03-16T08:47:33.608707400Z . label define bmicat 1 "Underweight (<18.5)"     ///
2021-03-16T08:47:33.608709600Z >                                         2 "Normal (18.5-24.9)"          ///
2021-03-16T08:47:33.608711700Z >                                         3 "Overweight (25-29.9)"        ///
2021-03-16T08:47:33.608714300Z >                                         4 "Obese I (30-34.9)"           ///
2021-03-16T08:47:33.608716400Z >                                         5 "Obese II (35-39.9)"          ///
2021-03-16T08:47:33.608718400Z >                                         6 "Obese III (40+)"                  
2021-03-16T08:47:33.608720500Z >    ///
2021-03-16T08:47:33.608722300Z >                                         .u "Unknown (.u)"
2021-03-16T08:47:33.608724200Z 
2021-03-16T08:47:33.608726100Z .                                         
2021-03-16T08:47:33.608727900Z . label values bmicat bmicat
2021-03-16T08:47:33.608729800Z 
2021-03-16T08:47:33.608731500Z . 
2021-03-16T08:47:33.608733700Z . * Create less  granular categorisation
2021-03-16T08:47:33.608735500Z . recode bmicat 1/3 .u = 1 4 = 2 5 = 3 6 = 4, gen(obese4cat)
2021-03-16T08:47:33.608737600Z (39337 differences between bmicat and obese4cat)
2021-03-16T08:47:33.608739400Z 
2021-03-16T08:47:33.608741300Z . 
2021-03-16T08:47:33.608755100Z . label define obese4cat  1 "No record of obesity"        ///
2021-03-16T08:47:33.608759200Z >                                                 2 "Obese I (30-34.9)"        
2021-03-16T08:47:33.608761900Z >    ///
2021-03-16T08:47:33.608763700Z >                                                 3 "Obese II (35-39.9)"       
2021-03-16T08:47:33.608766000Z >    ///
2021-03-16T08:47:33.608767900Z >                                                 4 "Obese III (40+)"          
2021-03-16T08:47:33.608770600Z >    
2021-03-16T08:47:33.608772500Z 
2021-03-16T08:47:33.608774200Z . 
2021-03-16T08:47:33.608776100Z . label values obese4cat obese4cat
2021-03-16T08:47:33.608781500Z 
2021-03-16T08:47:33.608783400Z . order obese4cat, after(bmicat)
2021-03-16T08:47:33.608785300Z 
2021-03-16T08:47:33.608787100Z . 
2021-03-16T08:47:33.608788800Z . /*  Smoking  */
2021-03-16T08:47:33.608790700Z . 
2021-03-16T08:47:33.608792400Z . * Smoking 
2021-03-16T08:47:33.608794200Z . label define smoke 1 "Never" 2 "Former" 3 "Current" .u "Unknown (.u)"
2021-03-16T08:47:33.608796400Z 
2021-03-16T08:47:33.608798200Z . 
2021-03-16T08:47:33.608799900Z . gen     smoke = 1  if smoking_status == "N"
2021-03-16T08:47:33.608801800Z (38,682 missing values generated)
2021-03-16T08:47:33.608803700Z 
2021-03-16T08:47:33.608805600Z . replace smoke = 2  if smoking_status == "E"
2021-03-16T08:47:33.608807500Z (386 real changes made)
2021-03-16T08:47:33.608809300Z 
2021-03-16T08:47:33.608811300Z . replace smoke = 3  if smoking_status == "S"
2021-03-16T08:47:33.608813800Z (2,421 real changes made)
2021-03-16T08:47:33.608815600Z 
2021-03-16T08:47:33.608818300Z . replace smoke = .u if smoking_status == "M"
2021-03-16T08:47:33.608820200Z (371 real changes made, 371 to missing)
2021-03-16T08:47:33.608822100Z 
2021-03-16T08:47:33.608823800Z . replace smoke = .u if smoking_status == "" 
2021-03-16T08:47:33.608825600Z (35,504 real changes made, 35,504 to missing)
2021-03-16T08:47:33.608827500Z 
2021-03-16T08:47:33.608829200Z . 
2021-03-16T08:47:33.608830900Z . label values smoke smoke
2021-03-16T08:47:33.608832700Z 
2021-03-16T08:47:33.608834400Z . drop smoking_status
2021-03-16T08:47:33.608836300Z 
2021-03-16T08:47:33.608838000Z . 
2021-03-16T08:47:33.608839700Z . * Create non-missing 3-category variable for current smoking
2021-03-16T08:47:33.608841600Z . * Assumes missing smoking is never smoking 
2021-03-16T08:47:33.608843700Z . recode smoke .u = 1, gen(smoke_nomiss)
2021-03-16T08:47:33.608845600Z (35875 differences between smoke and smoke_nomiss)
2021-03-16T08:47:33.608847400Z 
2021-03-16T08:47:33.608849200Z . order smoke_nomiss, after(smoke)
2021-03-16T08:47:33.608851100Z 
2021-03-16T08:47:33.608852800Z . label values smoke_nomiss smoke
2021-03-16T08:47:33.608854700Z 
2021-03-16T08:47:33.608856400Z . 
2021-03-16T08:47:33.608858200Z . 
2021-03-16T08:47:33.608859900Z . /* CLINICAL COMORBIDITIES */ 
2021-03-16T08:47:33.608861800Z . 
2021-03-16T08:47:33.608863600Z . /* GP consultation rate */ 
2021-03-16T08:47:33.608867800Z . replace gp_consult_count = 0 if gp_consult_count <1 
2021-03-16T08:47:33.608870000Z (166 real changes made)
2021-03-16T08:47:33.608871800Z 
2021-03-16T08:47:33.608873600Z . 
2021-03-16T08:47:33.608875300Z . * those with no count assumed to have no visits 
2021-03-16T08:47:33.608877200Z . replace gp_consult_count = 0 if gp_consult_count == . 
2021-03-16T08:47:33.608879400Z (0 real changes made)
2021-03-16T08:47:33.608881500Z 
2021-03-16T08:47:33.608883500Z . gen gp_consult = (gp_consult_count >=1)
2021-03-16T08:47:33.608885400Z 
2021-03-16T08:47:33.608887200Z . 
2021-03-16T08:47:33.608889000Z . 
2021-03-16T08:47:33.608891100Z . /* eGFR */
2021-03-16T08:47:33.608892900Z . 
2021-03-16T08:47:33.608894700Z . * Set implausible creatinine values to missing (Note: zero changed to missing
2021-03-16T08:47:33.608896700Z > )
2021-03-16T08:47:33.608898400Z . replace creatinine = . if !inrange(creatinine, 20, 3000) 
2021-03-16T08:47:33.608900300Z (11,625 real changes made, 11,625 to missing)
2021-03-16T08:47:33.608902100Z 
2021-03-16T08:47:33.608903800Z . 
2021-03-16T08:47:33.608905600Z . * Remove creatinine dates if no measurements, and vice versa 
2021-03-16T08:47:33.608907500Z . 
2021-03-16T08:47:33.608909400Z . replace creatinine = . if creatinine_measured_date == . 
2021-03-16T08:47:33.608911200Z (0 real changes made)
2021-03-16T08:47:33.608912900Z 
2021-03-16T08:47:33.608914700Z . replace creatinine_measured_date = . if creatinine == . 
2021-03-16T08:47:33.608916600Z (9,662 real changes made, 9,662 to missing)
2021-03-16T08:47:33.608918500Z 
2021-03-16T08:47:33.608920300Z . 
2021-03-16T08:47:33.608922200Z . 
2021-03-16T08:47:33.608924000Z . * Divide by 88.4 (to convert umol/l to mg/dl)
2021-03-16T08:47:33.608926000Z . gen SCr_adj = creatinine/88.4
2021-03-16T08:47:33.608927800Z (11,625 missing values generated)
2021-03-16T08:47:33.608929700Z 
2021-03-16T08:47:33.608931400Z . 
2021-03-16T08:47:33.608933500Z . gen min = .
2021-03-16T08:47:33.608935400Z (39,428 missing values generated)
2021-03-16T08:47:33.608937200Z 
2021-03-16T08:47:33.608938900Z . replace min = SCr_adj/0.7 if male==0
2021-03-16T08:47:33.608940700Z (14,011 real changes made)
2021-03-16T08:47:33.608942500Z 
2021-03-16T08:47:33.608944300Z . replace min = SCr_adj/0.9 if male==1
2021-03-16T08:47:33.608946100Z (13,792 real changes made)
2021-03-16T08:47:33.608948000Z 
2021-03-16T08:47:33.608949800Z . replace min = min^-0.329  if male==0
2021-03-16T08:47:33.608960900Z (14,011 real changes made)
2021-03-16T08:47:33.608963100Z 
2021-03-16T08:47:33.608964800Z . replace min = min^-0.411  if male==1
2021-03-16T08:47:33.608966900Z (13,792 real changes made)
2021-03-16T08:47:33.608968700Z 
2021-03-16T08:47:33.608970500Z . replace min = 1 if min<1
2021-03-16T08:47:33.608972400Z (24,495 real changes made)
2021-03-16T08:47:33.608974200Z 
2021-03-16T08:47:33.608975900Z . 
2021-03-16T08:47:33.608977600Z . gen max=.
2021-03-16T08:47:33.608979400Z (39,428 missing values generated)
2021-03-16T08:47:33.608981100Z 
2021-03-16T08:47:33.608983000Z . replace max=SCr_adj/0.7 if male==0
2021-03-16T08:47:33.608984800Z (14,011 real changes made)
2021-03-16T08:47:33.608986700Z 
2021-03-16T08:47:33.608988500Z . replace max=SCr_adj/0.9 if male==1
2021-03-16T08:47:33.608990300Z (13,792 real changes made)
2021-03-16T08:47:33.608992200Z 
2021-03-16T08:47:33.608994000Z . replace max=max^-1.209
2021-03-16T08:47:33.608995800Z (27,803 real changes made)
2021-03-16T08:47:33.608997900Z 
2021-03-16T08:47:33.608999700Z . replace max=1 if max>1
2021-03-16T08:47:33.609001600Z (14,933 real changes made)
2021-03-16T08:47:33.609003600Z 
2021-03-16T08:47:33.609005600Z . 
2021-03-16T08:47:33.609007600Z . gen egfr=min*max*141
2021-03-16T08:47:33.609009400Z (11,625 missing values generated)
2021-03-16T08:47:33.609011200Z 
2021-03-16T08:47:33.609012900Z . replace egfr=egfr*(0.993^age)
2021-03-16T08:47:33.609014700Z (27,803 real changes made)
2021-03-16T08:47:33.609016500Z 
2021-03-16T08:47:33.609018400Z . replace egfr=egfr*1.018 if male==0
2021-03-16T08:47:33.609020200Z (14,011 real changes made)
2021-03-16T08:47:33.609022100Z 
2021-03-16T08:47:33.609036200Z . label var egfr "egfr calculated using CKD-EPI formula with no eth"
2021-03-16T08:47:33.609041300Z 
2021-03-16T08:47:33.609043800Z . 
2021-03-16T08:47:33.609045800Z . * Categorise into ckd stages
2021-03-16T08:47:33.609048000Z . egen egfr_cat_all = cut(egfr), at(0, 15, 30, 45, 60, 5000)
2021-03-16T08:47:33.609050300Z (11625 missing values generated)
2021-03-16T08:47:33.609052200Z 
2021-03-16T08:47:33.609054100Z . recode egfr_cat_all 0 = 5 15 = 4 30 = 3 45 = 2 60 = 0, generate(ckd_egfr)
2021-03-16T08:47:33.609063700Z (27803 differences between egfr_cat_all and ckd_egfr)
2021-03-16T08:47:33.609068400Z 
2021-03-16T08:47:33.609070600Z . 
2021-03-16T08:47:33.609072500Z . /* 
2021-03-16T08:47:33.609078400Z > 0 "No CKD, eGFR>60"     or missing -- have been shown reasonable in CPRD
2021-03-16T08:47:33.609080700Z > 2 "stage 3a, eGFR 45-59" 
2021-03-16T08:47:33.609082600Z > 3 "stage 3b, eGFR 30-44" 
2021-03-16T08:47:33.609085800Z > 4 "stage 4, eGFR 15-29" 
2021-03-16T08:47:33.609088300Z > 5 "stage 5, eGFR <15"
2021-03-16T08:47:33.609090800Z > */
2021-03-16T08:47:33.609093500Z . 
2021-03-16T08:47:33.609096100Z . gen egfr_cat = .
2021-03-16T08:47:33.609100900Z (39,428 missing values generated)
2021-03-16T08:47:33.609104200Z 
2021-03-16T08:47:33.609106800Z . recode egfr_cat . = 3 if egfr < 30
2021-03-16T08:47:33.609109900Z (egfr_cat: 15508 changes made)
2021-03-16T08:47:33.609112800Z 
2021-03-16T08:47:33.609115400Z . recode egfr_cat . = 2 if egfr < 60
2021-03-16T08:47:33.609118000Z (egfr_cat: 6223 changes made)
2021-03-16T08:47:33.609120600Z 
2021-03-16T08:47:33.609123500Z . recode egfr_cat . = 1 if egfr < .
2021-03-16T08:47:33.609125700Z (egfr_cat: 6072 changes made)
2021-03-16T08:47:33.609127500Z 
2021-03-16T08:47:33.609129200Z . replace egfr_cat = .u if egfr >= .
2021-03-16T08:47:33.609131100Z (11,625 real changes made, 11,625 to missing)
2021-03-16T08:47:33.609132900Z 
2021-03-16T08:47:33.609134800Z . 
2021-03-16T08:47:33.609136600Z . label define egfr_cat   1 ">=60"                ///
2021-03-16T08:47:33.609138500Z >                                                 2 "30-59"               ///
2021-03-16T08:47:33.609140500Z >                                                 3 "<30"                 ///
2021-03-16T08:47:33.609142500Z >                                                 .u "Unknown (.u)"
2021-03-16T08:47:33.609144500Z 
2021-03-16T08:47:33.609146200Z .                                         
2021-03-16T08:47:33.609148100Z . label values egfr_cat egfr_cat
2021-03-16T08:47:33.609150000Z 
2021-03-16T08:47:33.609151800Z . 
2021-03-16T08:47:33.609153600Z . *if missing eGFR, assume normal
2021-03-16T08:47:33.609155400Z . 
2021-03-16T08:47:33.609157100Z . gen egfr_cat_nomiss = egfr_cat
2021-03-16T08:47:33.609159500Z (11,625 missing values generated)
2021-03-16T08:47:33.609161300Z 
2021-03-16T08:47:33.609163200Z . replace egfr_cat_nomiss = 1 if egfr_cat == .u
2021-03-16T08:47:33.609165300Z (11,625 real changes made)
2021-03-16T08:47:33.609167100Z 
2021-03-16T08:47:33.609168800Z . 
2021-03-16T08:47:33.609170600Z . label define egfr_cat_nomiss    1 ">=60/missing"        ///
2021-03-16T08:47:33.609175700Z >                                                                 2 "30-59"    
2021-03-16T08:47:33.609177800Z >                    ///
2021-03-16T08:47:33.609179800Z >                                                                 3 "<30" 
2021-03-16T08:47:33.609181800Z 
2021-03-16T08:47:33.609183600Z . label values egfr_cat_nomiss egfr_cat_nomiss
2021-03-16T08:47:33.609185500Z 
2021-03-16T08:47:33.609187200Z . 
2021-03-16T08:47:33.609189000Z . gen egfr_date = creatinine_measured_date
2021-03-16T08:47:33.609191000Z (11,625 missing values generated)
2021-03-16T08:47:33.609192900Z 
2021-03-16T08:47:33.609194700Z . format egfr_date %td
2021-03-16T08:47:33.609196500Z 
2021-03-16T08:47:33.609198300Z . 
2021-03-16T08:47:33.609200000Z . * Add in end stage renal failure and create a single CKD variable 
2021-03-16T08:47:33.609202000Z . * Missing assumed to not have CKD 
2021-03-16T08:47:33.609203900Z . gen ckd = 0
2021-03-16T08:47:33.609205700Z 
2021-03-16T08:47:33.609207400Z . replace ckd = 1 if ckd_egfr != . & ckd_egfr >= 1
2021-03-16T08:47:33.609209300Z (21,731 real changes made)
2021-03-16T08:47:33.609211100Z 
2021-03-16T08:47:33.609212900Z . replace ckd = 1 if esrf == 1
2021-03-16T08:47:33.609214800Z (1,791 real changes made)
2021-03-16T08:47:33.609216600Z 
2021-03-16T08:47:33.609218300Z . 
2021-03-16T08:47:33.609220100Z . label define ckd 0 "No CKD" 1 "CKD"
2021-03-16T08:47:33.609222100Z 
2021-03-16T08:47:33.609223800Z . label values ckd ckd
2021-03-16T08:47:33.609225600Z 
2021-03-16T08:47:33.609227500Z . label var ckd "CKD stage calc without eth"
2021-03-16T08:47:33.609229600Z 
2021-03-16T08:47:33.609231400Z . 
2021-03-16T08:47:33.609233600Z . * Create date (most recent measure prior to index)
2021-03-16T08:47:33.609235400Z . gen temp1_ckd_date = creatinine_measured_date if ckd_egfr >=1
2021-03-16T08:47:33.609237600Z (17,697 missing values generated)
2021-03-16T08:47:33.609239400Z 
2021-03-16T08:47:33.609241600Z . gen temp2_ckd_date = esrf_date if esrf == 1
2021-03-16T08:47:33.609243500Z (35,507 missing values generated)
2021-03-16T08:47:33.609245900Z 
2021-03-16T08:47:33.609247700Z . gen ckd_date = max(temp1_ckd_date,temp2_ckd_date) 
2021-03-16T08:47:33.609249600Z (15,906 missing values generated)
2021-03-16T08:47:33.609252100Z 
2021-03-16T08:47:33.609253800Z . format ckd_date %td 
2021-03-16T08:47:33.609255600Z 
2021-03-16T08:47:33.609257500Z . 
2021-03-16T08:47:33.609261400Z . /* HbA1c */
2021-03-16T08:47:33.609263400Z . 
2021-03-16T08:47:33.609265200Z . /*  Diabetes severity  */
2021-03-16T08:47:33.609267200Z . 
2021-03-16T08:47:33.609269400Z . * Set zero or negative to missing
2021-03-16T08:47:33.609271500Z . replace hba1c_percentage   = . if hba1c_percentage <= 0
2021-03-16T08:47:33.609273600Z (2,239 real changes made, 2,239 to missing)
2021-03-16T08:47:33.609275400Z 
2021-03-16T08:47:33.609277200Z . replace hba1c_mmol_per_mol = . if hba1c_mmol_per_mol <= 0
2021-03-16T08:47:33.609279100Z (2,834 real changes made, 2,834 to missing)
2021-03-16T08:47:33.609280900Z 
2021-03-16T08:47:33.609282600Z . 
2021-03-16T08:47:33.609284800Z . * Set most recent values of >15 months prior to index to missing
2021-03-16T08:47:33.609287100Z . replace hba1c_percentage   = . if (date("$indexdate", "DMY") - hba1c_percenta
2021-03-16T08:47:33.609289300Z > ge_date) > 15*30 & hba1c_percentage_date != .
2021-03-16T08:47:33.609291300Z (36,787 real changes made, 36,787 to missing)
2021-03-16T08:47:33.609293100Z 
2021-03-16T08:47:33.609294900Z . replace hba1c_mmol_per_mol = . if (date("$indexdate", "DMY") - hba1c_mmol_per
2021-03-16T08:47:33.609296800Z > _mol_date) > 15*30 & hba1c_mmol_per_mol_date != .
2021-03-16T08:47:33.609298900Z (36,212 real changes made, 36,212 to missing)
2021-03-16T08:47:33.609300700Z 
2021-03-16T08:47:33.609302600Z . 
2021-03-16T08:47:33.609304500Z . * Clean up dates
2021-03-16T08:47:33.609306400Z . replace hba1c_percentage_date = . if hba1c_percentage == .
2021-03-16T08:47:33.609308300Z (37,033 real changes made, 37,033 to missing)
2021-03-16T08:47:33.609310200Z 
2021-03-16T08:47:33.609312000Z . replace hba1c_mmol_per_mol_date = . if hba1c_mmol_per_mol == .
2021-03-16T08:47:33.609314200Z (37,055 real changes made, 37,055 to missing)
2021-03-16T08:47:33.609316400Z 
2021-03-16T08:47:33.609318200Z . 
2021-03-16T08:47:33.609320000Z . /* Express  HbA1c as percentage  */ 
2021-03-16T08:47:33.609321900Z . 
2021-03-16T08:47:33.609323700Z . * Express all values as perecentage 
2021-03-16T08:47:33.609325500Z . noi summ hba1c_percentage hba1c_mmol_per_mol 
2021-03-16T08:47:33.609327300Z 
2021-03-16T08:47:33.609329100Z     Variable |        Obs        Mean    Std. Dev.       Min        Max
2021-03-16T08:47:33.609331300Z -------------+---------------------------------------------------------
2021-03-16T08:47:33.609333200Z hba1c_per~ge |        402    5.223685    1.999445   .0918931   11.73686
2021-03-16T08:47:33.609335100Z hba1c_mmol~l |        382    40.73769    20.49006   1.224054   116.9926
2021-03-16T08:47:33.609339200Z 
2021-03-16T08:47:33.609341200Z . gen     hba1c_pct = hba1c_percentage 
2021-03-16T08:47:33.609343100Z (39,026 missing values generated)
2021-03-16T08:47:33.609344900Z 
2021-03-16T08:47:33.609346600Z . replace hba1c_pct = (hba1c_mmol_per_mol/10.929)+2.15 if hba1c_mmol_per_mol<. 
2021-03-16T08:47:33.609348600Z (382 real changes made)
2021-03-16T08:47:33.609350600Z 
2021-03-16T08:47:33.609352600Z . 
2021-03-16T08:47:33.609354500Z . * Valid % range between 0-20  
2021-03-16T08:47:33.609356400Z . replace hba1c_pct = . if !inrange(hba1c_pct, 0, 20) 
2021-03-16T08:47:33.609358300Z (0 real changes made)
2021-03-16T08:47:33.609360200Z 
2021-03-16T08:47:33.609361900Z . replace hba1c_pct = round(hba1c_pct, 0.1)
2021-03-16T08:47:33.609363900Z (779 real changes made)
2021-03-16T08:47:33.609365700Z 
2021-03-16T08:47:33.609367800Z . 
2021-03-16T08:47:33.609369500Z . /* Categorise hba1c and diabetes  */
2021-03-16T08:47:33.609371300Z . 
2021-03-16T08:47:33.609373100Z . * Group hba1c
2021-03-16T08:47:33.609375000Z . gen     hba1ccat = 0 if hba1c_pct <  6.5
2021-03-16T08:47:33.609376900Z (38,896 missing values generated)
2021-03-16T08:47:33.609378600Z 
2021-03-16T08:47:33.609380400Z . replace hba1ccat = 1 if hba1c_pct >= 6.5  & hba1c_pct < 7.5
2021-03-16T08:47:33.609382400Z (112 real changes made)
2021-03-16T08:47:33.609384200Z 
2021-03-16T08:47:33.609386000Z . replace hba1ccat = 2 if hba1c_pct >= 7.5  & hba1c_pct < 8
2021-03-16T08:47:33.609387900Z (50 real changes made)
2021-03-16T08:47:33.609389800Z 
2021-03-16T08:47:33.609391800Z . replace hba1ccat = 3 if hba1c_pct >= 8    & hba1c_pct < 9
2021-03-16T08:47:33.609399100Z (54 real changes made)
2021-03-16T08:47:33.609400900Z 
2021-03-16T08:47:33.609403200Z . replace hba1ccat = 4 if hba1c_pct >= 9    & hba1c_pct !=.
2021-03-16T08:47:33.609405700Z (31 real changes made)
2021-03-16T08:47:33.609407500Z 
2021-03-16T08:47:33.609409200Z . label define hba1ccat 0 "<6.5%" 1">=6.5-7.4" 2">=7.5-7.9" 3">=8-8.9" 4">=9"
2021-03-16T08:47:33.609411500Z 
2021-03-16T08:47:33.609413200Z . label values hba1ccat hba1ccat
2021-03-16T08:47:33.609415000Z 
2021-03-16T08:47:33.609416700Z . 
2021-03-16T08:47:33.609418500Z . * Create diabetes, split by control/not
2021-03-16T08:47:33.609420300Z . gen     diabcat = 1 if diabetes==0
2021-03-16T08:47:33.609422100Z (7,877 missing values generated)
2021-03-16T08:47:33.609423900Z 
2021-03-16T08:47:33.609428600Z . replace diabcat = 2 if diabetes==1 & inlist(hba1ccat, 0, 1)
2021-03-16T08:47:33.609430800Z (133 real changes made)
2021-03-16T08:47:33.609433100Z 
2021-03-16T08:47:33.609435300Z . replace diabcat = 3 if diabetes==1 & inlist(hba1ccat, 2, 3, 4)
2021-03-16T08:47:33.609437300Z (27 real changes made)
2021-03-16T08:47:33.609439200Z 
2021-03-16T08:47:33.609441200Z . replace diabcat = 4 if diabetes==1 & !inlist(hba1ccat, 0, 1, 2, 3, 4)
2021-03-16T08:47:33.609443700Z (7,717 real changes made)
2021-03-16T08:47:33.609445700Z 
2021-03-16T08:47:33.609447500Z . 
2021-03-16T08:47:33.609449300Z . label define diabcat    1 "No diabetes"                         ///
2021-03-16T08:47:33.609451300Z >                                                 2 "Controlled diabetes"      
2021-03-16T08:47:33.609453700Z >    ///
2021-03-16T08:47:33.609455800Z >                                                 3 "Uncontrolled diabetes"    
2021-03-16T08:47:33.609457900Z >    ///
2021-03-16T08:47:33.609460100Z >                                                 4 "Diabetes, no hba1c measure
2021-03-16T08:47:33.609462300Z > "
2021-03-16T08:47:33.609464100Z 
2021-03-16T08:47:33.609466300Z . label values diabcat diabcat
2021-03-16T08:47:33.609468300Z 
2021-03-16T08:47:33.609470000Z . 
2021-03-16T08:47:33.609471900Z . * create cancer *variable 'other cancer currently' includes carcinoma of the 
2021-03-16T08:47:33.609474100Z > head and neck - need to confirm if this excludes NMSC
2021-03-16T08:47:33.609476300Z . gen cancer =0
2021-03-16T08:47:33.609478300Z 
2021-03-16T08:47:33.609480600Z . replace cancer =1 if lung_cancer ==1 | haem_cancer ==1 | other_cancer ==1
2021-03-16T08:47:33.609482700Z (19,260 real changes made)
2021-03-16T08:47:33.609484700Z 
2021-03-16T08:47:33.609486500Z . 
2021-03-16T08:47:33.609488200Z . *creat other comorbid variables
2021-03-16T08:47:33.609490200Z . gen combined_cv_comorbid =1 if chronic_cardiac_disease ==1 | stroke==1
2021-03-16T08:47:33.609492200Z (25,189 missing values generated)
2021-03-16T08:47:33.609494100Z 
2021-03-16T08:47:33.609495900Z . 
2021-03-16T08:47:33.609497800Z . 
2021-03-16T08:47:33.609499700Z . * Delete unneeded variables
2021-03-16T08:47:33.609501800Z . drop hba1c_pct hba1c_percentage hba1c_mmol_per_mol
2021-03-16T08:47:33.609503600Z 
2021-03-16T08:47:33.609506000Z . 
2021-03-16T08:47:33.609508300Z . *****************************************************************************
2021-03-16T08:47:33.609510700Z > ********************
2021-03-16T08:47:33.609516000Z . /* POPULATIONS =============================================================*
2021-03-16T08:47:33.609519000Z > /
2021-03-16T08:47:33.609521200Z . 
2021-03-16T08:47:33.609523100Z . /* Diagnosis =============*/
2021-03-16T08:47:33.609524900Z . *include only most recent diagnosis within each specialty
2021-03-16T08:47:33.609526900Z . *Rheum
2021-03-16T08:47:33.609528800Z . replace rheumatoid_arthritis =0 if psoriatic_arthritis_date > rheumatoid_arth
2021-03-16T08:47:33.609531400Z > ritis_date & psoriatic_arthritis_date !=.
2021-03-16T08:47:33.609533300Z (721 real changes made)
2021-03-16T08:47:33.609535200Z 
2021-03-16T08:47:33.609537100Z . replace rheumatoid_arthritis =0 if ankylosing_spondylitis_date > rheumatoid_a
2021-03-16T08:47:33.609539700Z > rthritis_date & ankylosing_spondylitis_date !=.
2021-03-16T08:47:33.609542200Z (666 real changes made)
2021-03-16T08:47:33.609544100Z 
2021-03-16T08:47:33.609546000Z . replace psoriatic_arthritis     =0 if rheumatoid_arthritis_date > psoriatic_a
2021-03-16T08:47:33.609548300Z > rthritis_date & rheumatoid_arthritis_date !=.
2021-03-16T08:47:33.609550400Z (744 real changes made)
2021-03-16T08:47:33.609552200Z 
2021-03-16T08:47:33.609554100Z . replace psoriatic_arthritis     =0 if ankylosing_spondylitis_date > psoriatic
2021-03-16T08:47:33.609556100Z > _arthritis_date & ankylosing_spondylitis_date !=.
2021-03-16T08:47:33.609558100Z (729 real changes made)
2021-03-16T08:47:33.609559900Z 
2021-03-16T08:47:33.609561800Z . replace ankylosing_spondylitis =0 if psoriatic_arthritis_date > ankylosing_sp
2021-03-16T08:47:33.609563800Z > ondylitis_date & psoriatic_arthritis_date !=.
2021-03-16T08:47:33.609576200Z (765 real changes made)
2021-03-16T08:47:33.609582500Z 
2021-03-16T08:47:33.609585000Z . replace ankylosing_spondylitis =0 if rheumatoid_arthritis_date > ankylosing_s
2021-03-16T08:47:33.609588000Z > pondylitis_date & rheumatoid_arthritis_date !=.
2021-03-16T08:47:33.609590200Z (745 real changes made)
2021-03-16T08:47:33.609592000Z 
2021-03-16T08:47:33.609593800Z . 
2021-03-16T08:47:33.609595500Z .  
2021-03-16T08:47:33.609597300Z . *Derm
2021-03-16T08:47:33.609599100Z . replace psoriasis =0 if hidradenitis_suppurativa_date > psoriasis_date & hidr
2021-03-16T08:47:33.609601200Z > adenitis_suppurativa_date !=.
2021-03-16T08:47:33.609603000Z (789 real changes made)
2021-03-16T08:47:33.609604800Z 
2021-03-16T08:47:33.609606600Z . *replace psoriasis =0 if atopic_dermatitis_date > psoriasis_date & atopic_der
2021-03-16T08:47:33.609608600Z > matitis_date !=.
2021-03-16T08:47:33.609615200Z . replace hidradenitis_suppurativa =0 if psoriasis_date > hidradenitis_suppurat
2021-03-16T08:47:33.609617400Z > iva_date & psoriasis_date !=.
2021-03-16T08:47:33.609619400Z (773 real changes made)
2021-03-16T08:47:33.609621300Z 
2021-03-16T08:47:33.609623000Z . *replace hidradenitis_suppurativa =0 if atopic_dermatitis_date > hidradenitis
2021-03-16T08:47:33.609625100Z > _suppurativa_date & atopic_dermatitis_date !=.
2021-03-16T08:47:33.609627700Z . replace atopic_dermatitis =0 if psoriasis_date > atopic_dermatitis_date & pso
2021-03-16T08:47:33.609629800Z > riasis_date !=.
2021-03-16T08:47:33.609631600Z (821 real changes made)
2021-03-16T08:47:33.609633500Z 
2021-03-16T08:47:33.609635300Z . replace atopic_dermatitis =0 if hidradenitis_suppurativa_date > atopic_dermat
2021-03-16T08:47:33.609637300Z > itis_date & hidradenitis_suppurativa_date !=.
2021-03-16T08:47:33.609639100Z (647 real changes made)
2021-03-16T08:47:33.609640900Z 
2021-03-16T08:47:33.609642700Z . 
2021-03-16T08:47:33.609644500Z . *Gastro
2021-03-16T08:47:33.609646400Z . replace ibd_uncla =0 if ulcerative_colitis_date > ibd_uncla_date  & ulcerativ
2021-03-16T08:47:33.609648400Z > e_colitis_date !=.
2021-03-16T08:47:33.609650500Z (783 real changes made)
2021-03-16T08:47:33.609652300Z 
2021-03-16T08:47:33.609654100Z . replace ibd_uncla =0 if crohns_disease_date > ibd_uncla_date  & crohns_diseas
2021-03-16T08:47:33.609656100Z > e_date !=.
2021-03-16T08:47:33.609658100Z (685 real changes made)
2021-03-16T08:47:33.609659900Z 
2021-03-16T08:47:33.609661800Z . replace ulcerative_colitis =0 if crohns_disease_date > ulcerative_colitis_dat
2021-03-16T08:47:33.609663700Z > e & crohns_disease_date !=.
2021-03-16T08:47:33.609665500Z (785 real changes made)
2021-03-16T08:47:33.609667400Z 
2021-03-16T08:47:33.609669300Z . replace ulcerative_colitis =0 if ibd_uncla_date > ulcerative_colitis_date & i
2021-03-16T08:47:33.609671200Z > bd_uncla_date !=.
2021-03-16T08:47:33.609673400Z (684 real changes made)
2021-03-16T08:47:33.609675400Z 
2021-03-16T08:47:33.609677300Z . replace crohns_disease =0 if ulcerative_colitis_date > crohns_disease_date & 
2021-03-16T08:47:33.609679700Z > ulcerative_colitis_date !=.
2021-03-16T08:47:33.609681500Z (803 real changes made)
2021-03-16T08:47:33.609683300Z 
2021-03-16T08:47:33.609685100Z . replace crohns_disease =0 if ibd_uncla_date > crohns_disease_date & ibd_uncla
2021-03-16T08:47:33.609687000Z > _date !=.
2021-03-16T08:47:33.609689200Z (667 real changes made)
2021-03-16T08:47:33.609693500Z 
2021-03-16T08:47:33.609695400Z . 
2021-03-16T08:47:33.609697200Z . *consider the effect of patients diagnosed with imid post 1st March 2020
2021-03-16T08:47:33.609699200Z . *ignoring this will bias to null
2021-03-16T08:47:33.609701100Z . *diagnoses after 1st March have been culled via python code
2021-03-16T08:47:33.609703000Z . 
2021-03-16T08:47:33.609704800Z . gen imid = .
2021-03-16T08:47:33.609706700Z (39,428 missing values generated)
2021-03-16T08:47:33.609708600Z 
2021-03-16T08:47:33.609710300Z . replace imid = 1 if rheumatoid_arthritis ==1 | psoriatic_arthritis ==1 | anky
2021-03-16T08:47:33.609712200Z > losing_spondylitis==1 | ibd_uncla ==1 | ulcerative_colitis ==1 | crohns_disea
2021-03-16T08:47:33.609714300Z > se ==1 | psoriasis ==1 | hidradenitis_suppurativa ==1
2021-03-16T08:47:33.609716400Z (32,914 real changes made)
2021-03-16T08:47:33.609718200Z 
2021-03-16T08:47:33.609720300Z . replace imid = 0 if rheumatoid_arthritis !=1 & psoriatic_arthritis !=1 & ibd_
2021-03-16T08:47:33.609722300Z > uncla !=1 & ulcerative_colitis !=1 & crohns_disease !=1 & psoriasis !=1 & hid
2021-03-16T08:47:33.609724400Z > radenitis_suppurativa !=1 & ankylosing_spondylitis !=1
2021-03-16T08:47:33.609726400Z (6,514 real changes made)
2021-03-16T08:47:33.609728700Z 
2021-03-16T08:47:33.609730500Z . 
2021-03-16T08:47:33.609732500Z . label define imid 0 "Gen Pop" 1 "IMID"
2021-03-16T08:47:33.609734800Z 
2021-03-16T08:47:33.609736500Z . label values imid imid
2021-03-16T08:47:33.609738400Z 
2021-03-16T08:47:33.609740100Z . 
2021-03-16T08:47:33.609741900Z . gen bowel =0
2021-03-16T08:47:33.609810400Z 
2021-03-16T08:47:33.609813900Z . replace bowel =1 if crohns_disease ==1 | ibd_uncla ==1 | ulcerative_colitis =
2021-03-16T08:47:33.609816000Z > =1
2021-03-16T08:47:33.609818000Z (19,349 real changes made)
2021-03-16T08:47:33.609819800Z 
2021-03-16T08:47:33.609821600Z . label define bowel 0 "Gen Pop" 1 "Bowel"
2021-03-16T08:47:33.609823600Z 
2021-03-16T08:47:33.609825400Z . label values bowel bowel
2021-03-16T08:47:33.609827200Z 
2021-03-16T08:47:33.609829000Z . 
2021-03-16T08:47:33.609830700Z . gen skin =0
2021-03-16T08:47:33.609832500Z 
2021-03-16T08:47:33.609834300Z . replace skin =1 if psoriasis ==1 | hidradenitis_suppurativa ==1
2021-03-16T08:47:33.609836200Z (14,240 real changes made)
2021-03-16T08:47:33.609838000Z 
2021-03-16T08:47:33.609839800Z . label define skin 0 "Gen Pop" 1 "Skin"
2021-03-16T08:47:33.609848100Z 
2021-03-16T08:47:33.609850000Z . label values skin skin
2021-03-16T08:47:33.609851800Z 
2021-03-16T08:47:33.609853600Z . 
2021-03-16T08:47:33.609855400Z . gen joint =0
2021-03-16T08:47:33.609857200Z 
2021-03-16T08:47:33.609859000Z . replace joint =1 if rheumatoid_arthritis ==1 | psoriatic_arthritis ==1 | anky
2021-03-16T08:47:33.609860900Z > losing_spondylitis ==1
2021-03-16T08:47:33.609862800Z (19,213 real changes made)
2021-03-16T08:47:33.609864700Z 
2021-03-16T08:47:33.609874700Z . label define joint 0 "Gen Pop" 1 "Joint"
2021-03-16T08:47:33.609877100Z 
2021-03-16T08:47:33.609878800Z . label values joint joint
2021-03-16T08:47:33.609880600Z 
2021-03-16T08:47:33.609882400Z . 
2021-03-16T08:47:33.609884100Z . 
2021-03-16T08:47:33.609885800Z . *Loop to replace missing with 0
2021-03-16T08:47:33.609887700Z . foreach var of varlist  oral_prednisolone_3m_0m  ///
2021-03-16T08:47:33.609889600Z >                                                 oral_prednisolone_6m_3m  /// 
2021-03-16T08:47:33.609891500Z >                                                 adalimumab_3m_0m             
2021-03-16T08:47:33.609893600Z >     ///
2021-03-16T08:47:33.609895500Z >                                                 adalimumab_6m_3m             
2021-03-16T08:47:33.609897400Z >     ///
2021-03-16T08:47:33.609899200Z >                                                 abatacept_3m_0m              
2021-03-16T08:47:33.609901800Z >     ///
2021-03-16T08:47:33.609904400Z >                                                 abatacept_6m_3m              
2021-03-16T08:47:33.609906300Z >     ///
2021-03-16T08:47:33.609908100Z >                                                 certolizumab_3m_0m           
2021-03-16T08:47:33.609910000Z >     ///
2021-03-16T08:47:33.609911800Z >                                                 certolizumab_6m_3m       ///
2021-03-16T08:47:33.609913800Z >                                                 etanercept_3m_0m             
2021-03-16T08:47:33.609915600Z >     ///
2021-03-16T08:47:33.609917400Z >                                                 etanercept_6m_3m             
2021-03-16T08:47:33.609919300Z >     ///
2021-03-16T08:47:33.609921100Z >                                                 golimumab_3m_0m              
2021-03-16T08:47:33.609923000Z >     ///
2021-03-16T08:47:33.609924800Z >                                                 golimumab_6m_3m              
2021-03-16T08:47:33.609926800Z >     ///
2021-03-16T08:47:33.609928500Z >                                                 infliximab_3m_0m             
2021-03-16T08:47:33.609932800Z >     ///
2021-03-16T08:47:33.609934800Z >                                                 infliximab_6m_3m             
2021-03-16T08:47:33.609936700Z >     ///
2021-03-16T08:47:33.609938500Z >                                                 sarilumab_3m_0m              
2021-03-16T08:47:33.609940400Z >     ///
2021-03-16T08:47:33.609948300Z >                                                 sarilumab_6m_3m              
2021-03-16T08:47:33.609950700Z >     ///
2021-03-16T08:47:33.609952600Z >                                                 tocilizumab_3m_0m            
2021-03-16T08:47:33.609954500Z >     ///
2021-03-16T08:47:33.609956300Z >                                                 tocilizumab_6m_3m            
2021-03-16T08:47:33.609958200Z >     ///
2021-03-16T08:47:33.609959900Z >                                                 ustekinumab_3m_0m            
2021-03-16T08:47:33.609961800Z >     ///
2021-03-16T08:47:33.609963600Z >                                                 ustekinumab_6m_3m            
2021-03-16T08:47:33.609965400Z >     ///
2021-03-16T08:47:33.609967200Z >                                                 guselkumab_3m_0m             
2021-03-16T08:47:33.609969100Z >     ///
2021-03-16T08:47:33.609970900Z >                                                 guselkumab_6m_3m             
2021-03-16T08:47:33.609972700Z >     ///
2021-03-16T08:47:33.609974600Z >                                                 tildrakizumab_3m_0m      ///
2021-03-16T08:47:33.609976500Z >                                                 tildrakizumab_6m_3m      ///
2021-03-16T08:47:33.609978400Z >                                                 risankizumab_3m_0m           
2021-03-16T08:47:33.609980300Z >     ///
2021-03-16T08:47:33.609982000Z >                                                 risankizumab_6m_3m           
2021-03-16T08:47:33.609983900Z >     ///
2021-03-16T08:47:33.609985700Z >                                                 secukinumab_3m_0m            
2021-03-16T08:47:33.609987600Z >     ///
2021-03-16T08:47:33.609989400Z >                                                 secukinumab_6m_3m            
2021-03-16T08:47:33.609991300Z >     ///
2021-03-16T08:47:33.609993400Z >                                                 ixekizumab_3m_0m             
2021-03-16T08:47:33.609995300Z >     ///
2021-03-16T08:47:33.609997100Z >                                                 ixekizumab_6m_3m             
2021-03-16T08:47:33.609999000Z >     ///
2021-03-16T08:47:33.610000900Z >                                                 brodalumab_3m_0m             
2021-03-16T08:47:33.610005000Z >     ///
2021-03-16T08:47:33.610006900Z >                                                 brodalumab_6m_3m             
2021-03-16T08:47:33.610008800Z >     ///
2021-03-16T08:47:33.610010500Z >                                                 baricitinib_3m_0m            
2021-03-16T08:47:33.610012500Z >     ///
2021-03-16T08:47:33.610014300Z >                                                 baricitinib_6m_3m            
2021-03-16T08:47:33.610021800Z >     ///
2021-03-16T08:47:33.610024600Z >                                                 tofacitinib_3m_0m            
2021-03-16T08:47:33.610026600Z >     ///
2021-03-16T08:47:33.610028400Z >                                                 tofacitinib_6m_3m            
2021-03-16T08:47:33.610030300Z >     ///
2021-03-16T08:47:33.610032100Z >                                                 rituximab_12m_6m             
2021-03-16T08:47:33.610034000Z >     ///
2021-03-16T08:47:33.610035700Z >                                                 rituximab_6m_3m              
2021-03-16T08:47:33.610037600Z >     ///
2021-03-16T08:47:33.610039500Z >                                                 rituximab_3m_0m              
2021-03-16T08:47:33.610041400Z >     ///
2021-03-16T08:47:33.610043200Z >                                                 azathioprine_3m_0m           
2021-03-16T08:47:33.610045000Z >     ///
2021-03-16T08:47:33.610046900Z >                                                 azathioprine_6m_3m           
2021-03-16T08:47:33.610048800Z >     ///
2021-03-16T08:47:33.610050600Z >                                                 ciclosporin_3m_0m            
2021-03-16T08:47:33.610052600Z >     ///
2021-03-16T08:47:33.610054300Z >                                                 ciclosporin_6m_3m            
2021-03-16T08:47:33.610056200Z >     ///
2021-03-16T08:47:33.610058000Z >                                                 gold_3m_0m                   
2021-03-16T08:47:33.610059900Z >             ///
2021-03-16T08:47:33.610061700Z >                                                 gold_6m_3m                   
2021-03-16T08:47:33.610063700Z >             ///
2021-03-16T08:47:33.610065400Z >                                                 leflunomide_3m_0m            
2021-03-16T08:47:33.610067300Z >     ///
2021-03-16T08:47:33.610069100Z >                                                 leflunomide_6m_3m            
2021-03-16T08:47:33.610071000Z >     ///
2021-03-16T08:47:33.610072800Z >                                                 mercaptopurine_3m_0m     ///
2021-03-16T08:47:33.610077100Z >                                                 mercaptopurine_6m_3m     ///
2021-03-16T08:47:33.610079100Z >                                                 methotrexate_3m_0m           
2021-03-16T08:47:33.610081000Z >     ///
2021-03-16T08:47:33.610082900Z >                                                 methotrexate_6m_3m           
2021-03-16T08:47:33.610084800Z >     ///
2021-03-16T08:47:33.610086900Z >                                                 methotrexate_hcd_3m_0m   /// 
2021-03-16T08:47:33.610088800Z >    
2021-03-16T08:47:33.610096000Z >                                                 methotrexate_hcd_6m_3m   ///
2021-03-16T08:47:33.610098600Z >                                                 mycophenolate_3m_0m          
2021-03-16T08:47:33.610100500Z >     ///
2021-03-16T08:47:33.610102300Z >                                                 mycophenolate_6m_3m          
2021-03-16T08:47:33.610104200Z >     ///
2021-03-16T08:47:33.610106000Z >                                                 penicillamine_3m_0m          
2021-03-16T08:47:33.610107900Z >     ///
2021-03-16T08:47:33.610109700Z >                                                 penicillamine_6m_3m          
2021-03-16T08:47:33.610111600Z >     ///
2021-03-16T08:47:33.610113500Z >                                                 sulfasalazine_3m_0m          
2021-03-16T08:47:33.610115300Z > ///
2021-03-16T08:47:33.610117100Z >                                                 sulfasalazine_6m_3m          
2021-03-16T08:47:33.610119000Z >     ///
2021-03-16T08:47:33.610120900Z >                                                 mesalazine_3m_0m             
2021-03-16T08:47:33.610122800Z >     ///
2021-03-16T08:47:33.610124600Z >                                                 mesalazine_6m_3m        {
2021-03-16T08:47:33.610126500Z   2.                                                 
2021-03-16T08:47:33.610128400Z .                                                 replace `var' =0 if `var' ==.
2021-03-16T08:47:33.610130500Z   3.                                                 }
2021-03-16T08:47:33.610132400Z (0 real changes made)
2021-03-16T08:47:33.610134200Z (0 real changes made)
2021-03-16T08:47:33.610135900Z (0 real changes made)
2021-03-16T08:47:33.610137700Z (0 real changes made)
2021-03-16T08:47:33.610139600Z (0 real changes made)
2021-03-16T08:47:33.610141400Z (0 real changes made)
2021-03-16T08:47:33.610143100Z (0 real changes made)
2021-03-16T08:47:33.610144900Z (0 real changes made)
2021-03-16T08:47:33.610146700Z (0 real changes made)
2021-03-16T08:47:33.610148400Z (0 real changes made)
2021-03-16T08:47:33.610152600Z (0 real changes made)
2021-03-16T08:47:33.610154500Z (0 real changes made)
2021-03-16T08:47:33.610156300Z (0 real changes made)
2021-03-16T08:47:33.610158100Z (0 real changes made)
2021-03-16T08:47:33.610159900Z (0 real changes made)
2021-03-16T08:47:33.610161600Z (0 real changes made)
2021-03-16T08:47:33.610163400Z (0 real changes made)
2021-03-16T08:47:33.610171800Z (0 real changes made)
2021-03-16T08:47:33.610173800Z (0 real changes made)
2021-03-16T08:47:33.610175600Z (0 real changes made)
2021-03-16T08:47:33.610177300Z (0 real changes made)
2021-03-16T08:47:33.610179500Z (0 real changes made)
2021-03-16T08:47:33.610181300Z (0 real changes made)
2021-03-16T08:47:33.610183100Z (0 real changes made)
2021-03-16T08:47:33.610184900Z (0 real changes made)
2021-03-16T08:47:33.610186700Z (0 real changes made)
2021-03-16T08:47:33.610188400Z (0 real changes made)
2021-03-16T08:47:33.610190200Z (0 real changes made)
2021-03-16T08:47:33.610191900Z (0 real changes made)
2021-03-16T08:47:33.610193700Z (0 real changes made)
2021-03-16T08:47:33.610195500Z (0 real changes made)
2021-03-16T08:47:33.610197300Z (0 real changes made)
2021-03-16T08:47:33.610199100Z (0 real changes made)
2021-03-16T08:47:33.610200900Z (0 real changes made)
2021-03-16T08:47:33.610202800Z (0 real changes made)
2021-03-16T08:47:33.610204600Z (0 real changes made)
2021-03-16T08:47:33.610206300Z (0 real changes made)
2021-03-16T08:47:33.610208100Z (0 real changes made)
2021-03-16T08:47:33.610209900Z (0 real changes made)
2021-03-16T08:47:33.610211600Z (0 real changes made)
2021-03-16T08:47:33.610213400Z (0 real changes made)
2021-03-16T08:47:33.610215200Z (0 real changes made)
2021-03-16T08:47:33.610216900Z (0 real changes made)
2021-03-16T08:47:33.610218700Z (0 real changes made)
2021-03-16T08:47:33.610220400Z (0 real changes made)
2021-03-16T08:47:33.610222200Z (0 real changes made)
2021-03-16T08:47:33.610224700Z (0 real changes made)
2021-03-16T08:47:33.610227000Z (0 real changes made)
2021-03-16T08:47:33.610228900Z (0 real changes made)
2021-03-16T08:47:33.610230700Z (0 real changes made)
2021-03-16T08:47:33.610232400Z (0 real changes made)
2021-03-16T08:47:33.610234200Z (0 real changes made)
2021-03-16T08:47:33.610235900Z (0 real changes made)
2021-03-16T08:47:33.610237700Z (0 real changes made)
2021-03-16T08:47:33.610245200Z (0 real changes made)
2021-03-16T08:47:33.610247200Z (0 real changes made)
2021-03-16T08:47:33.610251400Z (0 real changes made)
2021-03-16T08:47:33.610253200Z (0 real changes made)
2021-03-16T08:47:33.610255000Z (0 real changes made)
2021-03-16T08:47:33.610256800Z (0 real changes made)
2021-03-16T08:47:33.610258600Z (0 real changes made)
2021-03-16T08:47:33.610260300Z 
2021-03-16T08:47:33.610262100Z . 
2021-03-16T08:47:33.610263900Z . 
2021-03-16T08:47:33.610265700Z . *stand sys drugs data are count, not binary!
2021-03-16T08:47:33.610267500Z . gen standsys =1 if azathioprine_3m_0m >=1 | azathioprine_6m_3m >=1 | ciclospo
2021-03-16T08:47:33.610269700Z > rin_3m_0m >=1 |ciclosporin_6m_3m >=1 | leflunomide_3m_0m >=1 |leflunomide_6m_
2021-03-16T08:47:33.610271700Z > 3m >=1 | mercaptopurine_3m_0m >=1 |mercaptopurine_6m_3m >=1 | methotrexate_3m
2021-03-16T08:47:33.610273800Z > _0m >=1 | methotrexate_6m_3m >=1 | methotrexate_hcd_3m_0m >=1 | methotrexate_
2021-03-16T08:47:33.610276000Z > hcd_6m_3m >=1 | mycophenolate_3m_0m >=1 | mycophenolate_6m_3m >=1 | sulfasala
2021-03-16T08:47:33.610278000Z > zine_3m_0m >=1 |sulfasalazine_6m_3m >=1 | mesalazine_3m_0m >=1 | mesalazine_6
2021-03-16T08:47:33.610280000Z > m_3m >=1
2021-03-16T08:47:33.610281900Z (7,782 missing values generated)
2021-03-16T08:47:33.610283800Z 
2021-03-16T08:47:33.610285700Z . replace standsys =. if imid !=1
2021-03-16T08:47:33.610287600Z (5,236 real changes made, 5,236 to missing)
2021-03-16T08:47:33.610289500Z 
2021-03-16T08:47:33.610291200Z . 
2021-03-16T08:47:33.610292900Z . gen standsys3m =1 if azathioprine_3m_0m >=1 | ciclosporin_3m_0m >=1 | lefluno
2021-03-16T08:47:33.610295000Z > mide_3m_0m >=1 | mercaptopurine_3m_0m >=1 | methotrexate_3m_0m >=1 | methotre
2021-03-16T08:47:33.610297200Z > xate_hcd_3m_0m >=1 | mycophenolate_3m_0m >=1 | sulfasalazine_3m_0m >=1  | mes
2021-03-16T08:47:33.610299500Z > alazine_3m_0m >=1
2021-03-16T08:47:33.610301400Z (17,566 missing values generated)
2021-03-16T08:47:33.610303400Z 
2021-03-16T08:47:33.610305100Z . replace standsys3m =. if imid !=1
2021-03-16T08:47:33.610306900Z (3,662 real changes made, 3,662 to missing)
2021-03-16T08:47:33.610308800Z 
2021-03-16T08:47:33.610310600Z . 
2021-03-16T08:47:33.610318200Z . gen tnf =1 if adalimumab_6m_3m !=0 | adalimumab_3m_0m !=0 | certolizumab_6m_3
2021-03-16T08:47:33.610321100Z > m !=0 | certolizumab_3m_0m !=0 | etanercept_6m_3m !=0 | etanercept_3m_0m !=0 
2021-03-16T08:47:33.610323100Z > | golimumab_6m_3m !=0 | golimumab_3m_0m !=0 | infliximab_6m_3m !=0 | inflixim
2021-03-16T08:47:33.610325100Z > ab_3m_0m !=0
2021-03-16T08:47:33.610329000Z (13,856 missing values generated)
2021-03-16T08:47:33.610331000Z 
2021-03-16T08:47:33.610332900Z . replace tnf =. if imid !=1
2021-03-16T08:47:33.610334800Z (4,253 real changes made, 4,253 to missing)
2021-03-16T08:47:33.610336800Z 
2021-03-16T08:47:33.610338500Z . 
2021-03-16T08:47:33.610340300Z . gen tnfmono =1 if tnf==1 & standsys !=1
2021-03-16T08:47:33.610342200Z (35,248 missing values generated)
2021-03-16T08:47:33.610344100Z 
2021-03-16T08:47:33.610345900Z . recode tnfmono .=0 if tnf==1 & standsys ==1
2021-03-16T08:47:33.610347800Z (tnfmono: 17139 changes made)
2021-03-16T08:47:33.610349700Z 
2021-03-16T08:47:33.610351400Z . 
2021-03-16T08:47:33.610353100Z . label define tnfmono    0 "TNF combination"                     ///
2021-03-16T08:47:33.610355100Z >                                                 1 "TNF monotherapy"     
2021-03-16T08:47:33.610357200Z 
2021-03-16T08:47:33.610359000Z . label values tnfmono tnfmono
2021-03-16T08:47:33.610360900Z 
2021-03-16T08:47:33.610363000Z . label var tnfmono "TNF strategy"
2021-03-16T08:47:33.610364900Z 
2021-03-16T08:47:33.610366800Z . 
2021-03-16T08:47:33.610368800Z . *high cost drug data pull through as binary variable, not count
2021-03-16T08:47:33.610370700Z . gen standtnf =1 if tnf ==1
2021-03-16T08:47:33.610372700Z (18,109 missing values generated)
2021-03-16T08:47:33.610374500Z 
2021-03-16T08:47:33.610376400Z . replace standtnf =0 if standsys ==1 & tnf !=1
2021-03-16T08:47:33.610378300Z (9,271 real changes made)
2021-03-16T08:47:33.610380100Z 
2021-03-16T08:47:33.610381800Z . 
2021-03-16T08:47:33.610383800Z . gen standtnf3m =1 if adalimumab_3m_0m ==1 | certolizumab_3m_0m ==1 | etanerce
2021-03-16T08:47:33.610385700Z > pt_3m_0m ==1 | golimumab_3m_0m ==1 | infliximab_3m_0m ==1
2021-03-16T08:47:33.610393900Z (23,329 missing values generated)
2021-03-16T08:47:33.610396100Z 
2021-03-16T08:47:33.610398100Z . replace standtnf3m =0 if adalimumab_3m_0m !=1 & certolizumab_3m_0m !=1 & etan
2021-03-16T08:47:33.610400200Z > ercept_3m_0m !=1 & golimumab_3m_0m !=1 & infliximab_3m_0m !=1 & standsys3m ==
2021-03-16T08:47:33.610402300Z > 1
2021-03-16T08:47:33.610404200Z (10,739 real changes made)
2021-03-16T08:47:33.610406000Z 
2021-03-16T08:47:33.610407900Z .                                 
2021-03-16T08:47:33.610409800Z . gen il23 =1 if ustekinumab_3m_0m !=0 | ustekinumab_6m_3m !=0 | guselkumab_3m_
2021-03-16T08:47:33.610412000Z > 0m !=0 | guselkumab_6m_3m !=0 | tildrakizumab_3m_0m !=0 | tildrakizumab_6m_3m
2021-03-16T08:47:33.610416300Z >  !=0 | risankizumab_3m_0m !=0 | risankizumab_6m_3m !=0 
2021-03-16T08:47:33.610418300Z (17,142 missing values generated)
2021-03-16T08:47:33.610420300Z 
2021-03-16T08:47:33.610422500Z . replace il23 =. if imid !=1
2021-03-16T08:47:33.610424500Z (3,710 real changes made, 3,710 to missing)
2021-03-16T08:47:33.610426300Z 
2021-03-16T08:47:33.610428600Z . 
2021-03-16T08:47:33.610430500Z . gen standil23 =1 if il23 ==1
2021-03-16T08:47:33.610432300Z (20,852 missing values generated)
2021-03-16T08:47:33.610434200Z 
2021-03-16T08:47:33.610435900Z . replace standil23 =0 if standsys ==1 & il23 !=1
2021-03-16T08:47:33.610437800Z (11,582 real changes made)
2021-03-16T08:47:33.610439600Z 
2021-03-16T08:47:33.610441400Z . 
2021-03-16T08:47:33.610443100Z . gen standil233m =1 if ustekinumab_3m_0m ==1 | guselkumab_3m_0m ==1 | tildraki
2021-03-16T08:47:33.610445100Z > zumab_3m_0m ==1 | risankizumab_3m_0m ==1 
2021-03-16T08:47:33.610446900Z (25,944 missing values generated)
2021-03-16T08:47:33.610448700Z 
2021-03-16T08:47:33.610450500Z . replace standil233m =0 if ustekinumab_3m_0m !=1 & guselkumab_3m_0m !=1 & tild
2021-03-16T08:47:33.610452500Z > rakizumab_3m_0m !=1 & risankizumab_3m_0m !=1 & standsys3m ==1
2021-03-16T08:47:33.610454500Z (11,997 real changes made)
2021-03-16T08:47:33.610456600Z 
2021-03-16T08:47:33.610458600Z . 
2021-03-16T08:47:33.610468100Z . gen jaki =1 if baricitinib_3m_0m !=0 | baricitinib_6m_3m !=0 | tofacitinib_3m
2021-03-16T08:47:33.610470500Z > _0m !=0 | tofacitinib_6m_3m !=0 
2021-03-16T08:47:33.610472500Z (25,865 missing values generated)
2021-03-16T08:47:33.610474300Z 
2021-03-16T08:47:33.610476000Z . replace jaki =. if imid !=1
2021-03-16T08:47:33.610477800Z (2,285 real changes made, 2,285 to missing)
2021-03-16T08:47:33.610479600Z 
2021-03-16T08:47:33.610481300Z . 
2021-03-16T08:47:33.610483000Z . gen standjaki =1 if jaki ==1
2021-03-16T08:47:33.610484800Z (28,150 missing values generated)
2021-03-16T08:47:33.610486700Z 
2021-03-16T08:47:33.610488400Z . replace standjaki =0 if standsys ==1 & jaki !=1
2021-03-16T08:47:33.610490500Z (17,342 real changes made)
2021-03-16T08:47:33.610492500Z 
2021-03-16T08:47:33.610494200Z . 
2021-03-16T08:47:33.610495900Z . gen standjaki3m =1 if baricitinib_3m_0m ==1 | tofacitinib_3m_0m ==1 
2021-03-16T08:47:33.610497900Z (31,956 missing values generated)
2021-03-16T08:47:33.610499800Z 
2021-03-16T08:47:33.610501500Z . replace standjaki3m =0 if baricitinib_3m_0m !=1 & tofacitinib_3m_0m !=1 & sta
2021-03-16T08:47:33.610505700Z > ndsys3m ==1
2021-03-16T08:47:33.610508000Z (14,753 real changes made)
2021-03-16T08:47:33.610509900Z 
2021-03-16T08:47:33.610511600Z . 
2021-03-16T08:47:33.610513400Z . gen ritux =1 if rituximab_3m_0m !=0 | rituximab_6m_3m !=0 | rituximab_12m_6m 
2021-03-16T08:47:33.610515300Z > !=0
2021-03-16T08:47:33.610517100Z (28,734 missing values generated)
2021-03-16T08:47:33.610519000Z 
2021-03-16T08:47:33.610520800Z . replace ritux =. if rheumatoid_arthritis !=1
2021-03-16T08:47:33.610522600Z (8,979 real changes made, 8,979 to missing)
2021-03-16T08:47:33.610524400Z 
2021-03-16T08:47:33.610526100Z . 
2021-03-16T08:47:33.610527900Z . gen standritux =1 if ritux ==1
2021-03-16T08:47:33.610529700Z (37,713 missing values generated)
2021-03-16T08:47:33.610531500Z 
2021-03-16T08:47:33.610533200Z . replace standritux =0 if standsys ==1 & ritux !=1
2021-03-16T08:47:33.610535300Z (25,014 real changes made)
2021-03-16T08:47:33.610544700Z 
2021-03-16T08:47:33.610546600Z . 
2021-03-16T08:47:33.610549300Z . gen standritux3m =1 if rituximab_3m_0m ==1
2021-03-16T08:47:33.610551200Z (35,472 missing values generated)
2021-03-16T08:47:33.610553100Z 
2021-03-16T08:47:33.610554800Z . replace standritux3m =0 if rituximab_3m_0m !=1 & standsys3m ==1
2021-03-16T08:47:33.610556800Z (16,371 real changes made)
2021-03-16T08:47:33.610558800Z 
2021-03-16T08:47:33.610560600Z . 
2021-03-16T08:47:33.610562600Z . gen il6 =1 if sarilumab_3m_0m !=0 | sarilumab_6m_3m !=0 | tocilizumab_3m_0m !
2021-03-16T08:47:33.610564700Z > =0 | tocilizumab_6m_3m !=0
2021-03-16T08:47:33.610567200Z (25,907 missing values generated)
2021-03-16T08:47:33.610569200Z 
2021-03-16T08:47:33.610571000Z . replace il6 =. if rheumatoid_arthritis !=1
2021-03-16T08:47:33.610572900Z (11,281 real changes made, 11,281 to missing)
2021-03-16T08:47:33.610574800Z 
2021-03-16T08:47:33.610576500Z . 
2021-03-16T08:47:33.610578200Z . gen standil6 =1 if il6 ==1
2021-03-16T08:47:33.610594000Z (37,188 missing values generated)
2021-03-16T08:47:33.610600000Z 
2021-03-16T08:47:33.610603300Z . replace standil6 =0 if standsys ==1 & il6 !=1
2021-03-16T08:47:33.610606700Z (24,615 real changes made)
2021-03-16T08:47:33.610609700Z 
2021-03-16T08:47:33.610628500Z . 
2021-03-16T08:47:33.610630600Z . gen standil63m =1 if sarilumab_3m_0m ==1 | tocilizumab_3m_0m ==1
2021-03-16T08:47:33.610632500Z (31,945 missing values generated)
2021-03-16T08:47:33.610634300Z 
2021-03-16T08:47:33.610640400Z . replace standil63m =0 if sarilumab_3m_0m !=1 & tocilizumab_3m_0m !=1 & stands
2021-03-16T08:47:33.610643100Z > ys3m ==1
2021-03-16T08:47:33.610644900Z (14,751 real changes made)
2021-03-16T08:47:33.610646800Z 
2021-03-16T08:47:33.610648800Z . 
2021-03-16T08:47:33.610650500Z . gen il17 =1 if secukinumab_3m_0m !=0 | secukinumab_6m_3m !=0 | ixekizumab_3m_
2021-03-16T08:47:33.610652400Z > 0m !=0 | ixekizumab_6m_3m !=0 | brodalumab_3m_0m !=0 | brodalumab_6m_3m !=0 
2021-03-16T08:47:33.610654400Z (20,881 missing values generated)
2021-03-16T08:47:33.610656100Z 
2021-03-16T08:47:33.610657900Z . replace il17 =. if psoriatic_arthritis !=1 & ankylosing_spondylitis !=1 & pso
2021-03-16T08:47:33.610659900Z > riasis !=1
2021-03-16T08:47:33.610661700Z (10,233 real changes made, 10,233 to missing)
2021-03-16T08:47:33.610663600Z 
2021-03-16T08:47:33.610665300Z . 
2021-03-16T08:47:33.610667100Z . gen standil17 =1 if il17 ==1
2021-03-16T08:47:33.610668900Z (31,114 missing values generated)
2021-03-16T08:47:33.610670700Z 
2021-03-16T08:47:33.610672400Z . replace standil17 =0 if standsys ==1 & il17 !=1
2021-03-16T08:47:33.610674300Z (19,707 real changes made)
2021-03-16T08:47:33.610676100Z 
2021-03-16T08:47:33.610677900Z . 
2021-03-16T08:47:33.610679600Z . gen standil173m =1 if secukinumab_3m_0m ==1 | ixekizumab_3m_0m ==1 | brodalum
2021-03-16T08:47:33.610681500Z > ab_3m_0m ==1 
2021-03-16T08:47:33.610683400Z (28,703 missing values generated)
2021-03-16T08:47:33.610685200Z 
2021-03-16T08:47:33.610687000Z . replace standil173m =0 if secukinumab_3m_0m !=1 & ixekizumab_3m_0m !=1 & brod
2021-03-16T08:47:33.610689100Z > alumab_3m_0m !=1 & standsys3m ==1
2021-03-16T08:47:33.610696700Z (13,276 real changes made)
2021-03-16T08:47:33.610699300Z 
2021-03-16T08:47:33.610701100Z . 
2021-03-16T08:47:33.610702900Z . gen mesalazine =1 if mesalazine_3m_0m >=1 | mesalazine_6m_3m >=1
2021-03-16T08:47:33.610704900Z (33,165 missing values generated)
2021-03-16T08:47:33.610706700Z 
2021-03-16T08:47:33.610709000Z . replace mesalazine =. if imid !=1
2021-03-16T08:47:33.610710900Z (1,052 real changes made, 1,052 to missing)
2021-03-16T08:47:33.610712800Z 
2021-03-16T08:47:33.610714500Z . 
2021-03-16T08:47:33.610716300Z . gen standmesalazine =1 if mesalazine >=1
2021-03-16T08:47:33.610718300Z 
2021-03-16T08:47:33.610720100Z . replace standmesalazine =0 if standsys ==1 & mesalazine ==0
2021-03-16T08:47:33.610721900Z (0 real changes made)
2021-03-16T08:47:33.610726100Z 
2021-03-16T08:47:33.610728000Z . 
2021-03-16T08:47:33.610729700Z . gen standmesalazine3m =1 if mesalazine_3m_0m >=1
2021-03-16T08:47:33.610731600Z (36,181 missing values generated)
2021-03-16T08:47:33.610733400Z 
2021-03-16T08:47:33.610735100Z . replace standmesalazine3m =0 if mesalazine_3m_0m ==0 & standsys3m ==1
2021-03-16T08:47:33.610737000Z (15,468 real changes made)
2021-03-16T08:47:33.610738800Z 
2021-03-16T08:47:33.610740500Z . 
2021-03-16T08:47:33.610920900Z . gen steroidcat = 0
2021-03-16T08:47:33.610929100Z 
2021-03-16T08:47:33.610931000Z . replace steroidcat =1 if oral_prednisolone_3m_0m >=1 & oral_prednisolone_3m_0
2021-03-16T08:47:33.610933200Z > m!=.
2021-03-16T08:47:33.610935000Z (3,361 real changes made)
2021-03-16T08:47:33.610936800Z 
2021-03-16T08:47:33.610938600Z . 
2021-03-16T08:47:33.610940300Z . *gen imiddrugcategory = (standard v highcost)
2021-03-16T08:47:33.610942200Z . gen imiddrugcategory = 1 if standtnf ==1 | standil23 ==1 | standjaki ==1 | st
2021-03-16T08:47:33.610944100Z > andritux ==1 | standil6 ==1 | standil17 ==1
2021-03-16T08:47:33.610946000Z (8,627 missing values generated)
2021-03-16T08:47:33.610947800Z 
2021-03-16T08:47:33.610949500Z . recode imiddrugcategory .=0 if standsys ==1 
2021-03-16T08:47:33.610951400Z (imiddrugcategory: 1670 changes made)
2021-03-16T08:47:33.610953200Z 
2021-03-16T08:47:33.610955000Z . 
2021-03-16T08:47:33.610956700Z . 
2021-03-16T08:47:33.610958500Z . /* OUTCOME AND SURVIVAL TIME=================================================
2021-03-16T08:47:33.610960400Z > =*/
2021-03-16T08:47:33.610962200Z . /*  Cohort entry and censor dates  */
2021-03-16T08:47:33.610964000Z . 
2021-03-16T08:47:33.610965800Z . * Date of cohort entry, 1 Mar 2020
2021-03-16T08:47:33.610967600Z . gen enter_date = date("$indexdate", "DMY")
2021-03-16T08:47:33.610969500Z 
2021-03-16T08:47:33.610971200Z . format enter_date %td
2021-03-16T08:47:33.610973100Z 
2021-03-16T08:47:33.610974900Z . 
2021-03-16T08:47:33.610976900Z . /*   Outcomes   */
2021-03-16T08:47:33.610978700Z . 
2021-03-16T08:47:33.610980500Z . * Outcomes: itu admission, ONS-covid death  
2021-03-16T08:47:33.610982300Z . 
2021-03-16T08:47:33.610984100Z . * Add half-day buffer if outcome on indexdate
2021-03-16T08:47:33.610986100Z . replace died_ons_date=died_ons_date+0.5 if died_ons_date==enter_date
2021-03-16T08:47:33.610994100Z (0 real changes made)
2021-03-16T08:47:33.610996400Z 
2021-03-16T08:47:33.611001100Z . replace icu_admitted_date=icu_admitted_date+0.5 if icu_admitted_date==enter_d
2021-03-16T08:47:33.611003200Z > ate
2021-03-16T08:47:33.611004900Z (0 real changes made)
2021-03-16T08:47:33.611006700Z 
2021-03-16T08:47:33.611008500Z . 
2021-03-16T08:47:33.611010200Z . * Date of Covid death in ONS
2021-03-16T08:47:33.611012000Z . gen died_ons_date_covid = died_ons_date if died_ons_covid_flag_any == 1
2021-03-16T08:47:33.611013900Z (39,015 missing values generated)
2021-03-16T08:47:33.611015800Z 
2021-03-16T08:47:33.611017500Z . 
2021-03-16T08:47:33.611019200Z . * Date of non-COVID death in ONS 
2021-03-16T08:47:33.611021000Z . * If missing date of death resulting died_date will also be missing
2021-03-16T08:47:33.611023000Z . gen died_ons_date_noncovid = died_ons_date if died_ons_covid_flag_any != 1 
2021-03-16T08:47:33.611025100Z (35,883 missing values generated)
2021-03-16T08:47:33.611026900Z 
2021-03-16T08:47:33.611028600Z . 
2021-03-16T08:47:33.611030400Z . *date of COVID ITU admission ** issue we have is how we define an ITU admissi
2021-03-16T08:47:33.611032300Z > on as a COVID one. 
2021-03-16T08:47:33.611034200Z . gen icu_admit_diff = icu_admitted_date - first_pos_test_sgss_date
2021-03-16T08:47:33.611036100Z (39,028 missing values generated)
2021-03-16T08:47:33.611037900Z 
2021-03-16T08:47:33.611039700Z . replace icu_admit_diff =. if icu_admit_diff <-5
2021-03-16T08:47:33.611041600Z (162 real changes made, 162 to missing)
2021-03-16T08:47:33.611043500Z 
2021-03-16T08:47:33.611046700Z . gen icu_admit_date_covid = icu_admitted_date if icu_admit_diff <28 
2021-03-16T08:47:33.611048700Z (39,400 missing values generated)
2021-03-16T08:47:33.611050500Z 
2021-03-16T08:47:33.611052300Z . 
2021-03-16T08:47:33.611054100Z . gen icu_or_death_covid_date = icu_admit_date_covid
2021-03-16T08:47:33.611055900Z (39,400 missing values generated)
2021-03-16T08:47:33.611057900Z 
2021-03-16T08:47:33.611059700Z . replace icu_or_death_covid_date = died_ons_date_covid if icu_admit_date_covid
2021-03-16T08:47:33.611067200Z >  ==.
2021-03-16T08:47:33.611069600Z (413 real changes made)
2021-03-16T08:47:33.611071500Z 
2021-03-16T08:47:33.611073200Z . gen icu_or_death_covid =1 if icu_or_death_covid_date !=.
2021-03-16T08:47:33.611075100Z (38,987 missing values generated)
2021-03-16T08:47:33.611076900Z 
2021-03-16T08:47:33.611078700Z . 
2021-03-16T08:47:33.611080400Z . format died_ons_date_covid died_ons_date_noncovid icu_admit_date_covid icu_or
2021-03-16T08:47:33.611082300Z > _death_covid_date %td
2021-03-16T08:47:33.611086400Z 
2021-03-16T08:47:33.611088200Z . 
2021-03-16T08:47:33.611089900Z . 
2021-03-16T08:47:33.611091600Z . /* CENSORING */
2021-03-16T08:47:33.611093400Z . /* SET FU DATES==============================================================
2021-03-16T08:47:33.611095400Z > =*/ 
2021-03-16T08:47:33.611097100Z . * Censoring dates for each outcome (largely, last date outcome data available
2021-03-16T08:47:33.611099000Z > , minus a lag window based on previous graphs)
2021-03-16T08:47:33.611100900Z . *death
2021-03-16T08:47:33.611102800Z . tw histogram died_ons_date, discrete width(2) frequency ytitle(Number of ONS 
2021-03-16T08:47:33.611104600Z > deaths) xtitle(Date) scheme(meta) saving(out_death_freq, replace)
2021-03-16T08:47:33.611106600Z (note: file out_death_freq.gph not found)
2021-03-16T08:47:33.611108500Z (file out_death_freq.gph saved)
2021-03-16T08:47:33.611110300Z 
2021-03-16T08:47:33.611112000Z . graph export "output/figures/out_death_freq.pdf", as(pdf) replace
2021-03-16T08:47:33.611114000Z unable to save PDF file
2021-03-16T08:47:33.611115800Z r(691);
2021-03-16T08:47:33.611117600Z 
2021-03-16T08:47:33.611119300Z end of do-file
2021-03-16T08:47:33.611121200Z r(691);
2021-03-16T08:47:33.611123000Z 


state: failed
commit: none
docker_image_id: sha256:5a4bb3ecd807de29a18a01ffae01739415778f0b770cbd43d7140bb0017306f1
job_id: ktrmmoqx27azqqpw
run_by_user: arowan
created_at: 2021-03-16T08:47:21Z
started_at: 2021-03-16T08:47:29Z
completed_at: 2021-03-16T08:47:34Z

Job exited with an error code

outputs:
  logs/cr_create_analysis_dataset.smcl  - moderately_sensitive